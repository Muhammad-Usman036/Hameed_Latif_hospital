<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Detail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="currency-helper.js"></script>
    <style>
        /* Mobile Sidebar Overlay */
        #sidebar-overlay {
            display: none;
        }
        #sidebar-overlay.active {
            display: block;
        }
        
        /* Sidebar responsive behavior */
        @media (max-width: 1024px) {
            #sidebar-patient {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                z-index: 50;
                transition: left 0.3s ease-in-out;
            }
            #sidebar-patient.active {
                left: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>
    
    <div class="flex min-h-screen">
        <!-- Sidebar (static visual to match app) -->
        <aside id="sidebar-patient" class="w-48 bg-white shadow-lg p-4 lg:static">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center"><i class="fas fa-plus text-white text-sm"></i></div>
                    <span class="text-lg font-bold text-gray-800">HOSPITAL</span>
                </div>
                <button id="close-sidebar" class="lg:hidden text-gray-600 hover:text-gray-800">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-2 text-sm">
                <a href="index.html" class="block px-4 py-2 rounded hover:bg-gray-50"><i class="fas fa-tachometer-alt w-4 mr-3"></i>Dashboard</a>
                <div class="px-4 py-2 rounded bg-orange-100 text-orange-600 border-r-4 border-orange-500"><i class="fas fa-users w-4 mr-3"></i>Patients</div>
            </div>
        </aside>

        <!-- Main -->
        <main class="flex-1 p-3 sm:p-4 md:p-6 overflow-x-hidden">
            <div class="max-w-7xl mx-auto">
                <!-- Mobile Menu Button -->
                <div class="flex items-center justify-between mb-3 lg:hidden">
                    <button id="mobile-menu-btn" class="p-2 rounded-lg bg-white shadow-sm text-gray-600 hover:text-gray-800">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
                
                <a href="index.html" class="inline-flex items-center text-xs sm:text-sm text-gray-500 hover:text-gray-700"><i class="fas fa-arrow-left mr-2"></i>Back to Patients List</a>
                <h1 class="mt-2 text-lg sm:text-xl font-semibold text-orange-600">Patient Detail</h1>

                <!-- Doctor and Bed Info -->
                <div class="mt-2 sm:mt-3">
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-2 sm:p-3">
                        <div class="flex flex-wrap items-center gap-3 sm:gap-4 text-xs sm:text-sm">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-user-md text-orange-600"></i>
                                <span class="text-gray-500">Doctor:</span>
                                <span class="font-medium text-gray-800" id="pd-doctor">-</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-bed text-orange-600"></i>
                                <span class="text-gray-500">Bed:</span>
                                <span class="font-medium text-gray-800" id="pd-bed">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Header card with Name and Vitals -->
                <div class="mt-3 sm:mt-4">
                    <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4">
                        <div class="flex flex-wrap items-center gap-3 sm:gap-4 md:gap-6 text-xs sm:text-sm">
                            <div class="flex items-center space-x-2 w-full sm:w-auto">
                                <span class="text-gray-500">Name:</span>
                                <span class="font-semibold text-gray-800" id="pd-name">John Doe</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-heartbeat text-red-500 text-xs"></i>
                                <span class="text-gray-500">BP:</span>
                                <span class="font-medium text-gray-800">120/80</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-heart text-blue-500 text-xs"></i>
                                <span class="text-gray-500">HR:</span>
                                <span class="font-medium text-gray-800">72 bpm</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-thermometer-half text-orange-500 text-xs"></i>
                                <span class="text-gray-500">Temp:</span>
                                <span class="font-medium text-gray-800">98.6Â°F</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-lungs text-green-500 text-xs"></i>
                                <span class="text-gray-500">RR:</span>
                                <span class="font-medium text-gray-800">16/min</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-wind text-purple-500 text-xs"></i>
                                <span class="text-gray-500">SpO2:</span>
                                <span class="font-medium text-gray-800">98%</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-weight text-indigo-500 text-xs"></i>
                                <span class="text-gray-500">Weight:</span>
                                <span class="font-medium text-gray-800">70 kg</span>
                            </div>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <i class="fas fa-tint text-pink-500 text-xs"></i>
                                <span class="text-gray-500">Glucose:</span>
                                <span class="font-medium text-gray-800">95 mg/dL</span>
                            </div>
                            <div class="flex items-center space-x-2 w-full sm:w-auto sm:ml-auto mt-2 sm:mt-0">
                                <span class="text-gray-400">Updated 2h ago</span>
                                <button class="px-2 py-1 bg-orange-500 text-white rounded text-xs hover:bg-orange-600">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="mt-3 sm:mt-4 flex flex-wrap gap-2 text-xs sm:text-sm">
                    <button data-tab="health" class="tab-btn px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white border text-nowrap">Health Record</button>
                    <button data-tab="case" class="tab-btn px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-orange-500 text-white text-nowrap">Case Sheet</button>
                    <button data-tab="attachments" class="tab-btn px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white border text-nowrap">Attachments</button>
                    <button data-tab="bills" class="tab-btn px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white border text-nowrap">Bills</button>
                    <button data-tab="insights" class="tab-btn px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white border text-nowrap">Clinical Insights</button>
                    <div class="flex-1 hidden sm:block"></div>
                    <button id="open-settings-pd" class="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-white shadow-sm text-gray-500 hover:text-gray-700 flex items-center justify-center"><i class="fas fa-cog"></i></button>
                </div>

                <!-- Panels -->
                <section id="panel-health" class="mt-3 sm:mt-4 grid grid-cols-1 lg:grid-cols-[0.8fr_1.2fr] gap-3 sm:gap-4 hidden">
                    <!-- Part 1: Existing Records (narrower column) -->
                    <div class="space-y-3 sm:space-y-4">
                        <!-- Visits -->
                        <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4">
                            <h3 class="font-semibold text-gray-800 mb-3 text-sm sm:text-base">Visits</h3>
                            <div class="space-y-2 sm:space-y-3 text-xs sm:text-sm">
                                <div class="border rounded-lg p-3 flex items-start justify-between">
                                    <div>
                                        <div class="font-medium text-gray-800">GOLA SWAN</div>
                                        <div class="text-gray-500">occasional pain</div>
                                    </div>
                                    <button class="text-gray-400"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="border rounded-lg p-3 flex items-start justify-between">
                                    <div>
                                        <div class="font-medium text-gray-800">ENT CHECK UP NAME</div>
                                        <div class="text-gray-500">follow up</div>
                                    </div>
                                    <button class="text-gray-400"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="border rounded-lg p-3 flex items-start justify-between">
                                    <div>
                                        <div class="font-medium text-gray-800">Asthma (M.D.S)</div>
                                        <div class="text-gray-500">mild</div>
                                    </div>
                                    <button class="text-gray-400"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                        </div>
                
                        <!-- Medication -->
                        <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4">
                            <h3 class="font-semibold text-gray-800 mb-3 text-sm sm:text-base">Medication</h3>
                            <div class="overflow-x-auto text-xs sm:text-sm">
                                <table class="min-w-full">
                                    <thead class="text-gray-500">
                                        <tr>
                                            <th class="text-left py-2 whitespace-nowrap">Medicine Name</th>
                                            <th class="text-left py-2 whitespace-nowrap">Dose</th>
                                            <th class="text-left py-2 whitespace-nowrap">Duration</th>
                                        </tr>
                                    </thead>
                                    <tbody id="medication-display-tbody" class="divide-y">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                
                        <!-- Additional Info -->
                        <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4">
                            <h3 class="font-semibold text-gray-800 mb-3 text-sm sm:text-base">Additional Information</h3>
                            <div class="text-xs sm:text-sm text-gray-600">
                                <p>Patient shows good response to current medication. Regular follow-up recommended.</p>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <h3 class="font-semibold text-gray-800 mb-3">Additional Information</h3>
                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                                <li>Allergic: Avocado</li>
                                <li>Non-smoker</li>
                                <li>Occasional fever symptoms</li>
                            </ul>
                        </div>
                    </div>
                
                    <!-- Part 2: Add Record Form (wider column) -->
                    <div class="bg-white rounded-lg shadow-sm p-3 sm:p-4">
                        <h3 class="font-semibold text-gray-800 mb-3 sm:mb-4 text-sm sm:text-base">Add New Record</h3>
                        <form id="add-record-form" class="space-y-3 sm:space-y-4">
                            <!-- Visit Information -->
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Visit Date & Time</label>
                                <input type="datetime-local" name="visitDateTime" class="w-full border border-gray-300 rounded px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm" required />
                            </div>
                
                            <!-- Doctor Selection -->
                            <div>
                                <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Doctor</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                    <select name="doctorDepartment" class="w-full border border-gray-300 rounded px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm" required>
                                        <option value="">Select Department</option>
                                        <option value="Cardiology">Cardiology</option>
                                        <option value="Neurology">Neurology</option>
                                        <option value="General Medicine">General Medicine</option>
                                        <option value="Emergency Medicine">Emergency Medicine</option>
                                        <option value="Internal Medicine">Internal Medicine</option>
                                        <option value="Pediatrics">Pediatrics</option>
                                        <option value="Surgery">Surgery</option>
                                        <option value="Orthopedics">Orthopedics</option>
                                        <option value="Dermatology">Dermatology</option>
                                    </select>
                                    <select name="doctor" class="w-full border border-gray-300 rounded px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm" required>
                                        <option value="">Select Doctor</option>
                                        <option value="Dr. Emily Smith">Dr. Emily Smith</option>
                                        <option value="Dr. John Wilson">Dr. John Wilson</option>
                                        <option value="Dr. Sarah Johnson">Dr. Sarah Johnson</option>
                                        <option value="Dr. Michael Brown">Dr. Michael Brown</option>
                                        <option value="Dr. Lisa Davis">Dr. Lisa Davis</option>
                                        <option value="Dr. Robert Taylor">Dr. Robert Taylor</option>
                                        <option value="Dr. Jennifer White">Dr. Jennifer White</option>
                                        <option value="Dr. David Miller">Dr. David Miller</option>
                                    </select>
                                </div>
                            </div>
                
                            <!-- Diagnosis -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Diagnosis</label>
                                <div class="flex items-center space-x-2">
                                    <input type="text" name="diagnosis" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Enter diagnosis" required />
                                    <button type="button" class="text-orange-500 hover:text-orange-600" title="Voice input">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                </div>
                            </div>
                
                            <!-- Symptoms -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Symptoms</label>
                                <div class="flex items-start space-x-2">
                                    <textarea name="symptoms" rows="3" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Describe symptoms"></textarea>
                                    <button type="button" class="text-orange-500 hover:text-orange-600 mt-1" title="Voice input">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                </div>
                            </div>
                
                            <!-- Medication/Tests/Radiology Tabs Section -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Medication / Tests / Radiology</label>
                                
                                <!-- Tabs -->
                                <div class="flex border-b border-gray-200 mb-3">
                                    <button type="button" class="tab-medication-btn px-4 py-2 text-sm font-medium border-b-2 border-orange-500 text-orange-500 font-semibold" data-tab="medication">
                                        Medication
                                    </button>
                                    <button type="button" class="tab-tests-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent" data-tab="tests">
                                        Tests
                                    </button>
                                    <button type="button" class="tab-radiology-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent" data-tab="radiology">
                                        Radiology
                                    </button>
                                </div>
                                
                                <!-- Medication Tab Content -->
                                <div id="tab-content-medication" class="tab-content">
                                    <div id="medication-list" class="space-y-2">
                                        <div class="flex flex-wrap items-center gap-2">
                                            <div class="flex-1 min-w-[120px] relative">
                                                <input type="text" name="medicine[]" list="medicine-list-options" class="w-full border border-gray-300 rounded px-3 py-2 text-sm pr-8" placeholder="Search medicine..." autocomplete="off" />
                                                <datalist id="medicine-list-options">
                                                    <option value="Paracetamol 500mg">Paracetamol 500mg</option>
                                                    <option value="Ibuprofen 400mg">Ibuprofen 400mg</option>
                                                    <option value="Amoxicillin 500mg">Amoxicillin 500mg</option>
                                                    <option value="Azithromycin 500mg">Azithromycin 500mg</option>
                                                    <option value="Ciprofloxacin 500mg">Ciprofloxacin 500mg</option>
                                                    <option value="Metformin 500mg">Metformin 500mg</option>
                                                    <option value="Amlodipine 5mg">Amlodipine 5mg</option>
                                                    <option value="Atorvastatin 20mg">Atorvastatin 20mg</option>
                                                    <option value="Omeprazole 20mg">Omeprazole 20mg</option>
                                                    <option value="Cetirizine 10mg">Cetirizine 10mg</option>
                                                    <option value="Aspirin 75mg">Aspirin 75mg</option>
                                                    <option value="Levothyroxine 50mcg">Levothyroxine 50mcg</option>
                                                    <option value="Metronidazole 400mg">Metronidazole 400mg</option>
                                                    <option value="Doxycycline 100mg">Doxycycline 100mg</option>
                                                    <option value="Cefixime 200mg">Cefixime 200mg</option>
                                                    <option value="Augmentin 625mg">Augmentin 625mg</option>
                                                    <option value="Pantoprazole 40mg">Pantoprazole 40mg</option>
                                                    <option value="Losartan 50mg">Losartan 50mg</option>
                                                    <option value="Atenolol 50mg">Atenolol 50mg</option>
                                                    <option value="Furosemide 40mg">Furosemide 40mg</option>
                                                </datalist>
                                                <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                                            </div>
                                            <input type="number" name="morning[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Morning" min="0" />
                                            <input type="number" name="afternoon[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Afternoon" min="0" />
                                            <input type="number" name="night[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Night" min="0" />
                                            <input type="text" name="duration[]" class="w-20 sm:w-20 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Duration" />
                                            <button type="button" onclick="addMedicine()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tests Tab Content -->
                                <div id="tab-content-tests" class="tab-content hidden">
                                    <div id="tests-list" class="space-y-2">
                                        <div class="flex flex-wrap items-center gap-2">
                                            <select name="testType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                                                <option value="">Select Test</option>
                                                <option value="Blood Count Tests">Blood Count Tests</option>
                                                <option value="Genetic Testing">Genetic Testing</option>
                                                <option value="Kidney Tests">Kidney Tests</option>
                                                <option value="Laboratory Tests">Laboratory Tests</option>
                                                <option value="Prenatal Testing">Prenatal Testing</option>
                                                <option value="Thyroid Tests">Thyroid Tests</option>
                                                <option value="Urinalysis">Urinalysis</option>
                                            </select>
                                            <input type="text" name="testNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                                            <button type="button" onclick="addTest()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Radiology Tab Content -->
                                <div id="tab-content-radiology" class="tab-content hidden">
                                    <div id="radiology-list" class="space-y-2">
                                        <div class="flex flex-wrap items-center gap-2">
                                            <select name="radiologyType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                                                <option value="">Select Radiology Test</option>
                                                <option value="X-Ray">X-Ray</option>
                                                <option value="CT Scan">CT Scan</option>
                                                <option value="MRI">MRI</option>
                                                <option value="Ultrasound">Ultrasound</option>
                                                <option value="Mammography">Mammography</option>
                                                <option value="Bone Scan">Bone Scan</option>
                                                <option value="PET Scan">PET Scan</option>
                                            </select>
                                            <input type="text" name="radiologyBodyPart[]" class="w-28 sm:w-32 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Body Part" />
                                            <input type="text" name="radiologyNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                                            <button type="button" onclick="addRadiology()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                
                            <!-- Clinical Notes -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Clinical Notes</label>
                                <div class="flex items-start space-x-2">
                                    <textarea name="notes" rows="3" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Additional notes"></textarea>
                                    <button type="button" class="text-orange-500 hover:text-orange-600 mt-1" title="Voice input">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                </div>
                            </div>
                
                            <!-- Form Actions -->
                            <div class="flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
                                <button type="button" onclick="clearForm()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                                    Clear
                                </button>
                                <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">
                                    <i class="fas fa-save mr-2"></i>Save Record
                                </button>
                            </div>
                        </form>
                    </div>
                
                    
                </section>
                

<!-- Add Health Record Modal -->
<div id="add-record-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Add Health Record</h3>
            <button data-close="add-record-modal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <div class="space-y-6 max-h-[75vh] overflow-y-auto">
            <!-- Vitals -->
            <div class="bg-white border rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Vitals</h4>
                <div class="grid grid-cols-2 md:grid-cols-6 gap-3 text-sm">
                    <div><label class="text-gray-500 block mb-1">Blood Pressure</label><input class="w-full border rounded px-3 py-2" placeholder="120/80"></div>
                    <div><label class="text-gray-500 block mb-1">Pulse</label><input class="w-full border rounded px-3 py-2" placeholder="98"></div>
                    <div><label class="text-gray-500 block mb-1">Temperature</label><input class="w-full border rounded px-3 py-2" placeholder="98.6"></div>
                    <div><label class="text-gray-500 block mb-1">Resp. Rate</label><input class="w-full border rounded px-3 py-2" placeholder="18"></div>
                    <div><label class="text-gray-500 block mb-1">Blood Sugar</label><input class="w-full border rounded px-3 py-2" placeholder="112"></div>
                    <div><label class="text-gray-500 block mb-1">Date & Time</label><input class="w-full border rounded px-3 py-2" placeholder="MM/DD/YYYY, 11:00 PM"></div>
                </div>
            </div>
            <!-- Medication -->
            <div class="bg-white border rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Medication</h4>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-3 text-sm items-end">
                    <div class="md:col-span-2"><label class="text-gray-500 block mb-1">Medicine Name</label><input class="w-full border rounded px-3 py-2" placeholder="e.g., TAB GELUSIL MPS"></div>
                    <div><label class="text-gray-500 block mb-1">Food Timing</label><select class="w-full border rounded px-3 py-2"><option>Select</option><option>After Food</option><option>Before Food</option></select></div>
                    <div class="flex space-x-1"><div><label class="text-gray-500 block mb-1">Dosage</label><div class="flex"> <input class="w-12 border rounded-l px-2 py-2" placeholder="1"><input class="w-12 border-t border-b px-2 py-2" placeholder="0"><input class="w-12 border rounded-r px-2 py-2" placeholder="1"> </div></div></div>
                    <div><label class="text-gray-500 block mb-1">Duration</label><input class="w-full border rounded px-3 py-2" placeholder="5 Days"></div>
                </div>
            </div>
            <!-- Additional sections simplified -->
            <div class="bg-white border rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Visit Information</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                    <div><label class="text-gray-500 block mb-1">Doctor Name</label><input class="w-full border rounded px-3 py-2" placeholder="Select Doctor"></div>
                    <div><label class="text-gray-500 block mb-1">Department</label><input class="w-full border rounded px-3 py-2" placeholder="Select Department"></div>
                    <div><label class="text-gray-500 block mb-1">Visit Date & Time</label><input class="w-full border rounded px-3 py-2" placeholder="MM/DD/YYYY, 1:00 PM"></div>
                </div>
            </div>
            <div class="bg-white border rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Clinical Notes</h4>
                <textarea class="w-full border rounded px-3 py-2" rows="3" placeholder="Enter clinical notes, observations, treatment plans, and follow-up instructions..."></textarea>
            </div>
            <div class="bg-white border rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">Diagnosis</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                    <div><label class="text-gray-500 block mb-1">Primary Diagnosis</label><input class="w-full border rounded px-3 py-2" placeholder="e.g., Fever"></div>
                    <div><label class="text-gray-500 block mb-1">Diagnosis Date</label><input class="w-full border rounded px-3 py-2" placeholder="MM/DD/YYYY"></div>
                </div>
            </div>
        </div>
        <div class="mt-6 flex items-center justify-end space-x-2">
            <button data-close="add-record-modal" class="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Cancel</button>
            <button class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Save Health Record</button>
        </div>
    </div>
</div>

<!-- Set Patient Target Value Modal -->
<div id="target-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Services and Vital Target Setting</h3>
            <button data-close="target-modal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <div class="space-y-4">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" placeholder="by Service" class="w-full pl-10 pr-3 py-2 border rounded">
            </div>
            <div>
                <div class="flex space-x-4 text-sm mb-2">
                    <button class="px-3 py-1 bg-orange-500 text-white rounded">Services</button>
                    <button class="px-3 py-1 border rounded">Vitals</button>
                </div>
                <div class="max-h-72 overflow-y-auto border rounded">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr class="text-left">
                                <th class="p-3">Services</th><th class="p-3">Target Range</th><th class="p-3">Current Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-t"><td class="p-3">Blood Test</td><td class="p-3">100</td><td class="p-3">-</td></tr>
                            <tr class="border-t"><td class="p-3">Testries</td><td class="p-3">45</td><td class="p-3">-</td></tr>
                            <tr class="border-t"><td class="p-3">BLOOD UREA NITROGEN BUN</td><td class="p-3">2</td><td class="p-3">-</td></tr>
                            <tr class="border-t"><td class="p-3">CALCIUM</td><td class="p-3">50</td><td class="p-3">-</td></tr>
                            <tr class="border-t"><td class="p-3">URIC ACID</td><td class="p-3">12</td><td class="p-3">-</td></tr>
                            <tr class="border-t"><td class="p-3">THYROID STIMULATING HORMONE</td><td class="p-3">45</td><td class="p-3">-</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <label class="text-sm text-gray-700">Target Stop Date</label>
                    <input type="text" value="11/27/2025" class="px-3 py-2 border rounded text-sm">
                </div>
                <div class="space-x-2">
                    <button class="px-4 py-2 bg-purple-600 text-white rounded">Update</button>
                    <button class="px-4 py-2 border rounded">Reset</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- View All History (Graph) Modal -->
<div id="history-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Patient Result History Graph View</h3>
            <button data-close="history-modal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <div class="h-80">
            <canvas id="historyChart"></canvas>
        </div>
    </div>
</div>

<!-- Bill Details Modal -->
<div id="bill-details-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl p-6 m-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Bill Details</h3>
            <button data-close="bill-details-modal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <div id="bill-details-content" class="space-y-4">
            <!-- Bill details will be populated here -->
        </div>
        <div class="mt-6 flex items-center justify-end space-x-2">
            <button onclick="printBill()" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex items-center space-x-2">
                <i class="fas fa-print"></i>
                <span>Print</span>
            </button>
            <button data-close="bill-details-modal" class="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Close</button>
        </div>
    </div>
</div>
                <section id="panel-case" class="mt-6">
                    <!-- Case Sheet Sub-tabs -->
                    <div class="flex flex-wrap gap-2 text-sm mb-4">
                        <button data-subtab="overview" class="subtab-btn px-4 py-2 rounded-full bg-orange-500 text-white">Case Sheet</button>
                        <button data-subtab="treatment" class="subtab-btn px-4 py-2 rounded-full bg-white border">Treatment Plan</button>
                        <button data-subtab="prescription" class="subtab-btn px-4 py-2 rounded-full bg-white border">Prescription</button>
                        <button data-subtab="radiology" class="subtab-btn px-4 py-2 rounded-full bg-white border">Radiology Test Results</button>
                        <button data-subtab="lab" class="subtab-btn px-4 py-2 rounded-full bg-white border">Lab Reports</button>
                        <button data-subtab="visit" class="subtab-btn px-4 py-2 rounded-full bg-white border">Visit Summary</button>
                    </div>

                    <!-- Case Sheet Overview Content (Default) -->
                    <div id="subpanel-overview">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">Gola Swain (General Medicine)</h3>
                                <div class="flex items-center space-x-2">
                                    <button class="text-gray-500 hover:text-gray-700"><i class="fas fa-print"></i></button>
                                    <button class="text-gray-500 hover:text-gray-700"><i class="fas fa-download"></i></button>
                                    <button class="text-gray-500 hover:text-gray-700" onclick="openConfigureCaseSheet()"><i class="fas fa-edit"></i></button>
                                    <button class="text-gray-500 hover:text-gray-700"><i class="fas fa-cog"></i></button>
                                </div>
                            </div>
                            
                            <div class="mb-4 text-sm text-gray-600">
                                <p><strong>Allergies:</strong> Cold stimuli</p>
                                <p><strong>Social Habits:</strong> Drinking, Tobacco chewing</p>
                                <p class="text-right text-gray-500">Oct 07, 2025</p>
                            </div>

                            <div id="case-sheet-content" class="space-y-3" style="display: none;">
                                <!-- Dynamic content will be generated here based on user selections -->
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Plan Content -->
                    <div id="subpanel-treatment" class="hidden">
                        <div class="bg-white p-6 rounded-lg shadow-sm mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Add Patient Treatment Plan</h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label for="treatment-plan" class="block text-sm font-medium text-gray-700 mb-1">Treatment Plan *</label>
                                    <select id="treatment-plan" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                        <option>Select TreatmentPlan</option>
                                        <option>Angio</option>
                                        <option>Occupational Therapy</option>
                                        <option>Radiation Treatment</option>
                                        <option>Panchakarma Massage</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="actual-start-date" class="block text-sm font-medium text-gray-700 mb-1">Actual Start Date</label>
                                    <input type="text" id="actual-start-date" placeholder="DD/MM/YYYY" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="actual-end-date-1" class="block text-sm font-medium text-gray-700 mb-1">Actual End Date</label>
                                    <input type="text" id="actual-end-date-1" placeholder="DD/MM/YYYY" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="physician" class="block text-sm font-medium text-gray-700 mb-1">Physician *</label>
                                    <select id="physician" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                        <option>Select</option>
                                        <option>Dr. Jaseela T</option>
                                        <option>Dr. Akila Raja</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="treatment-status" class="block text-sm font-medium text-gray-700 mb-1">Treatment Status</label>
                                    <select id="treatment-status" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                        <option>Select</option>
                                        <option>In-Progress</option>
                                        <option>Treatment going</option>
                                        <option>Started treatment</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="actual-end-date-2" class="block text-sm font-medium text-gray-700 mb-1">Actual End Date</label>
                                    <input type="text" id="actual-end-date-2" placeholder="DD/MM/YYYY" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                    <input type="text" id="status" placeholder="To diagnose" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                </div>
                            </div>
                            <div class="mb-6">
                                <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                <textarea id="notes" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm"></textarea>
                            </div>
                            <div class="flex space-x-3">
                                <button class="bg-orange-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2">Add Treatment Plan</button>
                                <button class="text-gray-600 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-offset-2">Reset</button>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Added Patient Treatment Plan</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-orange-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Treatment Plan</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Planned Start Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Physician</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actual Start Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actual End Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">1</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Angio</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Aug 5, 2023</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Jaseela T</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Aug 4, 2023</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Aug 4, 2023</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">In-Progress</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="#" class="text-orange-600 hover:text-orange-900"><i class="fas fa-pencil-alt"></i></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">2</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Occupational Therapy</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Aug 26, 2023</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Akila Raja</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Aug 31, 2023</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">â</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Treatment going</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="#" class="text-orange-600 hover:text-orange-900"><i class="fas fa-pencil-alt"></i></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">3</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Radiation Treatment</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jan 6, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Jaseela T</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jan 5, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jan 12, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Started treatment</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="#" class="text-orange-600 hover:text-orange-900"><i class="fas fa-pencil-alt"></i></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">4</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Panchakarma Massage</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Mar 8, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Jaseela T</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Mar 7, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Mar 26, 2024</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Treatment started</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <a href="#" class="text-orange-600 hover:text-orange-900"><i class="fas fa-pencil-alt"></i></a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Prescription Content -->
                    <div id="subpanel-prescription" class="hidden">
                        <div class="bg-white rounded-lg shadow-sm">
                            <!-- Prescription Management Header - RESPONSIVE -->
                            <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-3 sm:p-4 md:p-6 text-white">
                                <div class="flex flex-col gap-3">
                                    <div class="flex items-center space-x-2 sm:space-x-3">
                                        <div class="p-1.5 sm:p-2 bg-white bg-opacity-20 rounded-lg">
                                            <i class="fas fa-prescription-bottle-alt text-lg sm:text-xl md:text-2xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-base sm:text-xl md:text-2xl font-bold">Prescription Management</h3>
                                            <p class="text-orange-100 text-xs sm:text-sm hidden sm:block">Manage patient medications and prescriptions</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 flex-wrap w-full">
                                        <!-- Search Bar - Hidden on very small mobile -->
                                        <div class="relative hidden sm:block flex-1 max-w-xs">
                                            <input type="text" placeholder="Search medications..." class="pl-8 sm:pl-10 pr-3 sm:pr-4 py-2 sm:py-3 border-0 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 w-full text-xs sm:text-sm">
                                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs"></i>
                                        </div>
                                        <a href="add-medicine.html" class="flex-1 sm:flex-none px-3 sm:px-4 py-2 sm:py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium text-xs sm:text-sm whitespace-nowrap">
                                            <i class="fas fa-plus mr-1 sm:mr-2"></i>New Medicine
                                        </a>
                                        <button class="flex-1 sm:flex-none px-3 sm:px-4 md:px-6 py-2 sm:py-3 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-lg font-medium text-xs sm:text-sm whitespace-nowrap">
                                            <i class="fas fa-history mr-1 sm:mr-2 hidden sm:inline"></i><span class="hidden sm:inline">Previous</span> Med
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Prescription Entries -->
                            <div class="p-3 sm:p-4 md:p-6 space-y-3 sm:space-y-4">
                                <!-- Prescription 1 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-3 sm:p-4 md:p-6 shadow-md hover:shadow-lg transition-all duration-200">
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-3 sm:mb-4">
                                        <div class="flex items-center space-x-2 sm:space-x-3">
                                            <div class="p-1.5 sm:p-2 bg-purple-500 text-white rounded-lg">
                                                <i class="fas fa-prescription-bottle-alt text-sm sm:text-base"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm sm:text-base md:text-lg font-semibold text-gray-800 flex items-center flex-wrap">
                                                    <i class="fas fa-calendar-alt mr-1 sm:mr-2 text-purple-500 text-xs sm:text-sm"></i>
                                                    <span class="text-xs sm:text-sm md:text-base">Prescription on Apr 30, 2024</span>
                                                </p>
                                                <p class="text-xs sm:text-sm text-gray-600 flex items-center">
                                                    <i class="fas fa-user-md mr-1 sm:mr-2 text-purple-500 text-xs"></i>
                                                    Dr. GOLA SINGH - General Medicine
                                                </p>
                                            </div>
                                        </div>
                                       
                                    </div>
                                    
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-gray-50 text-gray-700 border-b-2 border-orange-200">
                                                <tr>
                                                    <th class="text-left py-3 px-4 font-semibold"><input type="checkbox" class="rounded text-orange-500 focus:ring-orange-500"></th>
                                                    <th class="text-left py-3 px-4 font-semibold">Form</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Medicine Name</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Duration</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Timing</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Quantity</th>
                                                    
                                                    <th class="text-left py-3 px-4 font-semibold">Net Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-100">
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Ibuprofen PM</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">2 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">Before Food</td>
                                                    <td class="py-2 px-4 text-gray-700">2</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Amoxicillin</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">1 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">After Food</td>
                                                    <td class="py-2 px-4 text-gray-700">1</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Augmentin</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">1 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">After Food</td>
                                                    <td class="py-2 px-4 text-gray-700">1</td>

                                                    <!-- <td class="py-2 px-4 text-gray-700">-</td> -->
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Prescription 2 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-200">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-3">
                                            <div class="p-2 bg-blue-500 text-white rounded-lg">
                                                <i class="fas fa-prescription-bottle-alt"></i>
                                            </div>
                                            <div>
                                                <p class="text-lg font-semibold text-gray-800 flex items-center">
                                                    <i class="fas fa-calendar-alt mr-2 text-blue-500"></i>
                                                    Prescription on May 2, 2024, 10:15:30 AM
                                                </p>
                                                <p class="text-sm text-gray-600 flex items-center">
                                                    <i class="fas fa-user-md mr-2 text-blue-500"></i>
                                                    Dr. DEEPAK KU MAR - General Medicine
                                                </p>
                                            </div>
                                        </div>
                                      
                                    </div>
                                    
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-gray-50 text-gray-700 border-b-2 border-orange-200">
                                                <tr>
                                                    <th class="text-left py-3 px-4 font-semibold"><input type="checkbox" class="rounded text-orange-500 focus:ring-orange-500"></th>
                                                    <th class="text-left py-3 px-4 font-semibold">Form</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Medicine Name</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Duration</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Timing</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Quantity</th>
                                                    
                                                    <th class="text-left py-3 px-4 font-semibold">Net Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-100">
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Paracetamol</td>
                                                    <td class="py-2 px-4 text-gray-700">3 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">After Food</td>
                                                    <td class="py-2 px-4 text-gray-700">1</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Tof 600 MG</td>
                                                    <td class="py-2 px-4 text-gray-700">5 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">Before Food</td>
                                                    <td class="py-2 px-4 text-gray-700">1</td>
                                                    
                                                    <td class="py-2 px-4 text-gray-700">-</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Prescription 3 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-md hover:shadow-lg transition-all duration-200">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-3">
                                            <div class="p-2 bg-green-500 text-white rounded-lg">
                                                <i class="fas fa-prescription-bottle-alt"></i>
                                            </div>
                                            <div>
                                                <p class="text-lg font-semibold text-gray-800 flex items-center">
                                                    <i class="fas fa-calendar-alt mr-2 text-green-500"></i>
                                                    Prescription on May 2, 2024, 2:30:45 PM
                                                </p>
                                                <p class="text-sm text-gray-600 flex items-center">
                                                    <i class="fas fa-user-md mr-2 text-green-500"></i>
                                                    Dr. Akshay NIKHIL - Dental
                                                </p>
                                            </div>
                                        </div>
                                       
                                    </div>
                                    
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-gray-50 text-gray-700 border-b-2 border-orange-200">
                                                <tr>
                                                    <th class="text-left py-3 px-4 font-semibold"><input type="checkbox" class="rounded text-orange-500 focus:ring-orange-500"></th>
                                                    <th class="text-left py-3 px-4 font-semibold">Form</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Medicine Name</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Duration</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Timing</th>
                                                    <th class="text-left py-3 px-4 font-semibold">Quantity</th>
                                                   
                                                    <th class="text-left py-3 px-4 font-semibold">Net Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-100">
                                                <tr>
                                                    <td class="py-2 px-4"><input type="checkbox" class="rounded"></td>
                                                    <td class="py-2 px-4 text-gray-700">Tablet</td>
                                                    <td class="py-2 px-4 text-gray-700">Aspirin</td>
                                                    <td class="py-2 px-4 text-gray-700">7 Days</td>
                                                    <td class="py-2 px-4 text-gray-700">After Food</td>
                                                    <td class="py-2 px-4 text-gray-700">1</td>
                                                   
                                                    <td class="py-2 px-4 text-gray-700">-</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Radiology Test Results Content -->
                    <div id="subpanel-radiology" class="hidden">
                        <div class="bg-white rounded-lg shadow-sm">
                            <!-- Radiology Sub-tabs -->
                            <div class="flex flex-wrap gap-2 text-sm mb-4 p-6 pb-4">
                                <button data-radio-subtab="radiology" class="radio-subtab-btn px-4 py-2 rounded-full bg-orange-500 text-white">Radiology</button>
                                <button data-radio-subtab="all-orders" class="radio-subtab-btn px-4 py-2 rounded-full bg-white border">All Orders</button>
                            </div>

                            <!-- Radiology Content (Default) -->
                            <div id="radio-subpanel-radiology" class="radio-subtab-panel" style="display: block;">
                                <div class="p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-semibold text-gray-800">Radiology Orders</h3>
                                        <div class="flex space-x-2">
                                            <button onclick="openNewOrderModal()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">
                                                <i class="fas fa-plus mr-2"></i>New Test
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Search and Filter Section -->
                                    <div class="mb-6 border-b border-gray-200 pb-6">
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                                <input type="text" placeholder="Search orders..." class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                                <input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                                <input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div class="flex items-end space-x-2">
                                                <button class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Search</button>
                                                <button class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">Reset</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Radiology Orders Table -->
                                    <div class="mb-6">
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-orange-50">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item/Test</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ordered By</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="radiology-orders-tbody" class="bg-white divide-y divide-gray-200">
                                                    <!-- Sample radiology order -->
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-003</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <div>Michael Chen</div>
                                                            <div class="text-xs text-gray-500">MRN-1247</div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Radiology</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Chest X-Ray</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Usman</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">In Progress</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2014-01-15 10:00</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">Complete</button>
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">View</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Summary Cards -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Pending Approval</p>
                                                    <p class="text-2xl font-bold text-orange-500 mt-1">2</p>
                                                </div>
                                                <div class="p-3 bg-orange-100 rounded-full">
                                                    <i class="fas fa-clock text-orange-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">In Progress</p>
                                                    <p class="text-2xl font-bold text-orange-500 mt-1">1</p>
                                                </div>
                                                <div class="p-3 bg-orange-100 rounded-full">
                                                    <i class="fas fa-spinner text-orange-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Completed Today</p>
                                                    <p class="text-2xl font-bold text-green-500 mt-1">1</p>
                                                </div>
                                                <div class="p-3 bg-green-100 rounded-full">
                                                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Total Today</p>
                                                    <p class="text-2xl font-bold text-orange-500 mt-1">5</p>
                                                </div>
                                                <div class="p-3 bg-orange-100 rounded-full">
                                                    <i class="fas fa-list-alt text-orange-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- All Orders Content -->
                            <div id="radio-subpanel-all-orders" class="radio-subtab-panel" style="display: none;">
                                <div class="p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-semibold text-gray-800">All Orders</h3>
                                        <div class="flex space-x-2">
                                            <button onclick="openNewOrderModal()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">
                                                <i class="fas fa-plus mr-2"></i>New Order
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Search and Filter Section -->
                                    <div class="mb-6 border-b border-gray-200 pb-6">
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                                <input type="text" placeholder="Search orders..." class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                                <input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                                <input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div class="flex items-end space-x-2">
                                                <button class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Search</button>
                                                <button class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">Reset</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- All Orders Table -->
                                    <div class="mb-6">
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-orange-50">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item/Test</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ordered By</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="all-orders-tbody" class="bg-white divide-y divide-gray-200">
                                                    <!-- Lab Order -->
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-001</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <div>Sarah Johnson</div>
                                                            <div class="text-xs text-gray-500">MRN-1245</div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Lab</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Blood Test</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. John Doe</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 15, 2024 09:30</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">View</button>
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">Share</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <!-- Radiology Order -->
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-002</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <div>Michael Chen</div>
                                                            <div class="text-xs text-gray-500">MRN-1247</div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Radiology</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">CT Scan</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Jane Smith</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">Pending</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 14, 2024 14:20</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">View</button>
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">Share</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <!-- Pharmacy Order -->
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-003</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <div>Emily Davis</div>
                                                            <div class="text-xs text-gray-500">MRN-1250</div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Pharmacy</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Antibiotics</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Mark Wilson</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 13, 2024 11:15</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">View</button>
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">Share</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <!-- Another Lab Order -->
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ORD-004</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <div>Robert Brown</div>
                                                            <div class="text-xs text-gray-500">MRN-1252</div>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Lab</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Urine Analysis</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dr. Sarah Lee</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">In Progress</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 12, 2024 16:45</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">View</button>
                                                                <button class="px-3 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded text-xs">Share</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Summary Cards for All Orders -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Total Orders</p>
                                                    <p class="text-2xl font-bold text-orange-500 mt-1">15</p>
                                                </div>
                                                <div class="p-3 bg-orange-100 rounded-full">
                                                    <i class="fas fa-list-alt text-orange-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Lab Orders</p>
                                                    <p class="text-2xl font-bold text-blue-500 mt-1">8</p>
                                                </div>
                                                <div class="p-3 bg-blue-100 rounded-full">
                                                    <i class="fas fa-vial text-blue-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Radiology Orders</p>
                                                    <p class="text-2xl font-bold text-purple-500 mt-1">5</p>
                                                </div>
                                                <div class="p-3 bg-purple-100 rounded-full">
                                                    <i class="fas fa-x-ray text-purple-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Pharmacy Orders</p>
                                                    <p class="text-2xl font-bold text-green-500 mt-1">2</p>
                                                </div>
                                                <div class="p-3 bg-green-100 rounded-full">
                                                    <i class="fas fa-pills text-green-500 text-xl"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lab Reports Content -->
                    <div id="subpanel-lab" class="hidden">
                        <div class="bg-white rounded-lg shadow-sm">
                            <!-- Lab Reports Sub-tabs -->
                            <div class="flex flex-wrap gap-2 text-sm mb-4">
                                <button data-lab-subtab="lab-order" class="lab-subtab-btn px-4 py-2 rounded-full bg-orange-500 text-white">Lab Order Wise</button>
                                <button data-lab-subtab="test-wise" class="lab-subtab-btn px-4 py-2 rounded-full bg-white border">Test Wise</button>
                            </div>

                            <!-- Lab Order Wise Content (Default) -->
                            <div id="lab-subpanel-order" class="lab-subtab-panel" style="display: block;">
                                <div class="bg-white rounded-lg shadow-sm">
                                    <div class="flex items-center justify-between p-6 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800">Lab Reports</h3>
                                <div class="flex space-x-2">
                                    <button id="open-target" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Set Patient Target Value</button>
                                    <button id="open-history" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">View All History</button>
                                </div>
                                    </div>
                                    
                                    <!-- Search and Filter Section -->
                                    <div class="p-6 border-b border-gray-200">
                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                                <input type="text" placeholder="Eg: Lab Reports" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                                <input type="text" placeholder="MM/DD/YYYY" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                                <input type="text" placeholder="MM/DD/YYYY" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                            </div>
                                            <div class="flex items-end space-x-2">
                                                <button class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Search</button>
                                                <button class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">Reset</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Lab Results Table -->
                                    <div class="p-6">
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-orange-50">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lab Result No.</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sample Date</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Physician</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Technician</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="bg-white divide-y divide-gray-200">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">1</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000001</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 12, 2022</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Ashwin Rammohan</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">2</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000002</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Dec 15, 2022</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jaseela T Bukhari</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">3</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000003</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jan 5, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Ashwin Rammohan</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">4</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000004</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Feb 10, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jaseela T Bukhari</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">5</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000005</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Mar 15, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Ashwin Rammohan</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">6</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000006</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Apr 20, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jaseela T Bukhari</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">7</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000007</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">May 25, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Ashwin Rammohan</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">8</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">RH2200000008</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">OP</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Sep 4, 2023</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Jaseela T Bukhari</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                            <span class="px-2 py-1 bg-orange-500 text-white rounded-full text-xs">Completed</span>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <div class="flex space-x-2">
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-eye"></i></button>
                                                                <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-share"></i></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Pagination -->
                                        <div class="flex items-center justify-between mt-6">
                                            <div class="text-sm text-gray-700">
                                                Showing <span class="font-medium">1</span> to <span class="font-medium">8</span> of <span class="font-medium">8</span> results
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="px-3 py-1 bg-gray-200 text-gray-600 rounded hover:bg-gray-300"><i class="fas fa-chevron-left"></i></button>
                                                <button class="px-3 py-1 bg-orange-500 text-white rounded">1</button>
                                                <button class="px-3 py-1 bg-gray-200 text-gray-600 rounded hover:bg-gray-300">2</button>
                                                <button class="px-3 py-1 bg-gray-200 text-gray-600 rounded hover:bg-gray-300"><i class="fas fa-chevron-right"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Wise Content -->
                            <div id="lab-subpanel-test" class="lab-subtab-panel" style="display: none;">
                                <div class="bg-white rounded-lg shadow-sm">
                                    <div class="flex items-center justify-between p-6 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800">Lab Reports</h3>
                                <div class="flex space-x-2">
                                    <button id="open-target-2" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Set Patient Target Value</button>
                                    <button id="open-history-2" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">View All History</button>
                                </div>
                                    </div>
                                    
                                    <!-- Test Results Table -->
                                    <div class="p-6">
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full divide-y divide-gray-200">
                                                <thead class="bg-orange-50">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">View Graph</th>
                                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Name</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Target Value</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">02 May 24<br>1:12 PM</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">21 Dec 23<br>11:11 AM</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">06 Nov 23<br>7:16 PM</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">04 Sep 23<br>8:29 PM</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">05 Jul 23<br>1:17 PM</th>
                                                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">12 Dec 22<br>5:35 PM</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="bg-white divide-y divide-gray-200">
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Triglycerides</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">44</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">22</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">32</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">55</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Appearance Bile Pigments</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">44</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Bile Salts</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">42</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Bilirubin Blood Casts</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">42</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Colour Crystals</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">33</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                                            <button class="text-orange-600 hover:text-orange-900"><i class="fas fa-chart-bar"></i></button>
                                                        </td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Epithelial Cells</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">32</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">-</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visit Summary Content -->
                    <div id="subpanel-visit" class="hidden">
                        <div class="bg-white rounded-lg shadow-sm">
                            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800">Visit Summary</h3>
                                <div class="relative">
                                    <input type="text" placeholder="Search visits..." class="w-64 px-4 py-2 pl-10 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="p-6 space-y-6 max-h-96 overflow-y-auto">
                                <!-- Visit 1 -->
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-4">
                                        <div class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-semibold text-gray-800">Appointment with Dr. GOLA SINGH on May 2, 2034</h4>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-3"><strong>Reason:</strong> Abdominal pain</p>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                                <div>
                                                    <h5 class="text-sm font-medium text-gray-700 mb-1">Vitals</h5>
                                                    <div class="text-sm text-gray-600 space-y-1">
                                                        <p>P - 45 kg</p>
                                                        <p>H - 175 cm</p>
                                                        <p>BMI - 21.2</p>
                                                        <p class="text-green-600">Healthy weight range for young and middle-aged adults</p>
                                                        <p>BP: 120/100</p>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h5 class="text-sm font-medium text-gray-700 mb-1">More Vitals</h5>
                                                    <div class="text-sm text-gray-600 space-y-1">
                                                        <p>Temp: 98.6</p>
                                                        <p>SpO2 - 98</p>
                                                        <p>Pulse: 96</p>
                                                        <p>RR: 18</p>
                                                        <p>BS: 88</p>
                                                        <p>Sugar Level: F-152, PP-100, PL-100</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="space-y-2 text-sm">
                                                <p><strong>Examination:</strong> Abdominal inspection</p>
                                                <p><strong>Investigation:</strong> USG R/L - CUS - Complete BNH Examination</p>
                                                <p><strong>Prescription:</strong> Tab. GELUSIL, MPL, Paracetamol</p>
                                                <p><strong>Instructions:</strong> Review after 3-5 Days</p>
                                                <p><strong>Vaccines:</strong> -</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Visit 2 -->
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-4">
                                        <div class="w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-semibold text-gray-800">Appointment with Dr. DEEPAK KU MAR on May 2, 2034</h4>
                                            </div>
                                            <p class="text-sm text-gray-600 mb-3"><strong>Reason:</strong> Follow-up consultation</p>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                                <div>
                                                    <h5 class="text-sm font-medium text-gray-700 mb-1">Vitals</h5>
                                                    <div class="text-sm text-gray-600 space-y-1">
                                                        <p>P - 45 kg</p>
                                                        <p>H - 175 cm</p>
                                                        <p>BMI - 21.2</p>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h5 class="text-sm font-medium text-gray-700 mb-1">More Vitals</h5>
                                                    <div class="text-sm text-gray-600 space-y-1">
                                                        <p>BP: 120/90</p>
                                                        <p>Pulse: 96</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="space-y-2 text-sm">
                                                <p><strong>Examination:</strong> General physical examination</p>
                                                <p><strong>Investigation:</strong> Blood test recommended</p>
                                                <p><strong>Prescription:</strong> No new medications</p>
                                                <p><strong>Instructions:</strong> Continue current treatment</p>
                                                <p><strong>Vaccines:</strong> none</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="panel-attachments" class="mt-6 hidden">
                    <div class="bg-white rounded-lg shadow-sm">
                        <div class="flex items-center justify-between p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Attachments</h3>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <!-- Left Navigation -->
                                <div class="lg:col-span-1">
                                    <div class="space-y-4">
                                        <button class="w-full text-left px-4 py-2 text-orange-600 hover:bg-orange-50 rounded-lg font-medium">Add Attachments</button>
                                        <button class="w-full text-left px-4 py-2 text-orange-600 hover:bg-orange-50 rounded-lg font-medium">View Attachments</button>
                                    </div>
                                </div>
                                
                                <!-- Main Content -->
                                <div class="lg:col-span-3">
                                    <!-- Date Filters -->
                                    <div class="mb-6">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                                <div class="relative">
                                                    <input type="text" value="5/1/2024" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                                    <i class="fas fa-calendar absolute right-3 top-3 text-gray-400"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                                <div class="relative">
                                                    <input type="text" value="5/7/2024" class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                                    <i class="fas fa-calendar absolute right-3 top-3 text-gray-400"></i>
                                                </div>
                                            </div>
                                            <div class="flex items-end space-x-2">
                                                <button class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium">Search</button>
                                                <button class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium">Reset</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Attachment Cards -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- General Attachment Card -->
                                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                                            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                                                <span class="text-orange-600 font-medium">General</span>
                                                <button class="text-gray-500 hover:text-gray-700"><i class="fas fa-share"></i></button>
                                            </div>
                                            <div class="p-4">
                                                <h4 class="font-medium text-gray-800 mb-2">Case Sheet Summary.pdf</h4>
                                                <p class="text-sm text-gray-600">May 2, 2024</p>
                                            </div>
                                            <div class="bg-orange-500 text-white px-4 py-2 flex items-center justify-between">
                                                <span class="text-sm">Admin</span>
                                                <button class="text-white hover:text-gray-200"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                        
                                        <!-- Lab Attachment Card -->
                                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                                            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                                                <span class="text-orange-600 font-medium">Lab</span>
                                                <button class="text-gray-500 hover:text-gray-700"><i class="fas fa-share"></i></button>
                                            </div>
                                            <div class="p-4">
                                                <h4 class="font-medium text-gray-800 mb-2">Lab Result Entry.pdf</h4>
                                                <p class="text-sm text-gray-600">May 2, 2024</p>
                                            </div>
                                            <div class="bg-orange-500 text-white px-4 py-2 flex items-center justify-between">
                                                <span class="text-sm">Labtech</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="panel-bills" class="mt-6 hidden">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Billed</p>
                                    <p class="text-2xl font-bold text-gray-900" data-currency data-amount="7999">Rs. 7,999.00</p>
                                </div>
                                <div class="p-3 bg-orange-100 rounded-full">
                                    <i class="fas fa-file-invoice text-orange-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Paid</p>
                                    <p class="text-2xl font-bold text-green-600" data-currency data-amount="7999">Rs. 7,999.00</p>
                                </div>
                                <div class="p-3 bg-green-100 rounded-full">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Outstanding Balance</p>
                                    <p class="text-2xl font-bold text-green-600" data-currency data-amount="0">Rs. 0.00</p>
                                </div>
                                <div class="p-3 bg-green-100 rounded-full">
                                    <i class="fas fa-balance-scale text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm">
                        <div class="flex items-center justify-between p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Bills</h3>
                            <div id="currency-selector-bills-container" class="w-48">
                                <!-- Currency selector will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Search and Filter Section -->
                        <div class="p-6 border-b border-gray-200">
                           
                            <div class="p-6 border-b border-gray-200">
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-[150px_150px_150px_1fr] gap-4 items-end">
                                  
                                  <!-- Bill Status -->
                                  <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bill Status</label>
                                    <div class="relative">
                                      <select
                                        class="w-full px-3 py-2 pr-10 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm appearance-none">
                                        <option>Select</option>
                                        <option>Paid</option>
                                        <option>Pending</option>
                                        <option>Overdue</option>
                                      </select>
                                      <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                  </div>
                              
                                  <!-- From Date -->
                                  <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                    <div class="relative">
                                      <input type="date" value="5/4/2022"
                                        class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                    </div>
                                  </div>
                              
                                  <!-- To Date -->
                                  <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                    <div class="relative">
                                      <input type="date" value="5/7/2024"
                                        class="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                                    </div>
                                  </div>
                              
                                  <!-- Buttons -->
                                  <div class="flex flex-wrap sm:flex-nowrap justify-start sm:justify-end gap-2">
                                    <button
                                      class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium w-full sm:w-auto">
                                      <i class="fas fa-search mr-1"></i>Search
                                    </button>
                                    <button
                                      class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm font-medium w-full sm:w-auto">
                                      <i class="fas fa-refresh mr-1"></i>Reset
                                    </button>
                                    <a href="add-bill.html"
                                      class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium w-full sm:w-auto text-center">
                                      <i class="fas fa-plus mr-1"></i>Add New Bill
                                    </a>
                                  </div>
                                </div>
                              </div>
                              
                        </div>

                        <!-- Bills Table -->
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-orange-50">
                                        <tr>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bill #</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Billing Date</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Services</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th scope="col" class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bills-table-body" class="bg-white divide-y divide-gray-200">
                                        <!-- Bills will be loaded dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="panel-insights" class="mt-6 hidden">
                    <div class="bg-white rounded-lg shadow-sm">
                        <div class="flex items-center justify-between p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Clinical Insights</h3>
                        </div>
                        
                        <div class="p-6">
                            <!-- Patient Summary -->
                            <div class="mb-6 p-4 bg-orange-50 rounded-lg">
                                <p class="text-gray-800 mb-2"><strong>Mr.Thilagan has visited our hospital 53 times.</strong></p>
                                <p class="text-gray-700 mb-1">The health condition most significantly affecting is: <span class="text-orange-600 font-semibold">Fever (Occurred 5 times)</span></p>
                                <p class="text-gray-700">Most frequently prescribed medication: <span class="text-orange-600 font-semibold">TAB ACLOC 150MG</span></p>
                            </div>

                            <!-- Sub-tabs -->
                            <div class="flex flex-wrap gap-2 text-sm mb-6">
                                <button data-insight-subtab="lists" class="insight-subtab-btn px-4 py-2 rounded-full bg-orange-500 text-white">Lists</button>
                                <button data-insight-subtab="charts" class="insight-subtab-btn px-4 py-2 rounded-full bg-white border">Charts</button>
                            </div>

                            <!-- Lists Content (Default) -->
                            <div id="insight-subpanel-lists" class="insight-subtab-panel">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <!-- Prescribed Medications -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Prescribed Medications</h4>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                TAB ACLOC 150MG
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                TAB GELUSIL MPS
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Paracetamol
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                TAB ZONTAL 400 MG
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Dolo tablets 650
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                CAP ANTACID
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Aspirin
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                SYP DOLO 250
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Diagnosis -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Diagnosis</h4>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Severe Cholera
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Bradilice purpuric fever
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Viral Fever
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Gastric Problem
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Temporal mandibular Joint Disorder
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Visit Breakdown -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Visit Breakdown</h4>
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-700">2022</span>
                                                <span class="text-sm font-medium text-gray-900">4</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-700">2023</span>
                                                <span class="text-sm font-medium text-gray-900">37</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-sm text-gray-700">2024</span>
                                                <span class="text-sm font-medium text-gray-900">12</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Investigation -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Investigation</h4>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                URINE R/E - CUE - Complete Urine Examination
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Absolute Basophil Count-ABC
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                ABSOLUTE LEUCOCYTE COUNT
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Absolute Lymphocyte Count-ALC
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                LIPID PROFILE
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                X-RAY HIP AP Charges
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                FBS (Fasting Blood Sugar)
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Instructions -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Instructions</h4>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Review after 2-3 Days
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Avoid Salt
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Avoid Sweets
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Complaints -->
                                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-4">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Complaints</h4>
                                        <ul class="space-y-2 text-sm text-gray-700">
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Abdominal pain (Occurred 2 times)
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Fever (Occurred 5 times)
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Abdominal Aortic Aneurysm
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Acute bronchitis
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Head Ache (Occurred 2 times)
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                High Fever
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Acute gastritis (Occurred 2 times)
                                            </li>
                                            <li class="flex items-start">
                                                <span class="w-2 h-2 bg-orange-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                                                Increased Urination
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Charts Content -->
                            <div id="insight-subpanel-charts" class="insight-subtab-panel hidden">
                                <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6 text-center">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Charts & Analytics</h4>
                                    <p class="text-gray-600">Chart visualizations will be displayed here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Fill from query param (mock)
        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        if (id) {
            document.getElementById('pd-name').textContent = `Patient #${id}  John Smith `;
        }

        // Load doctor and bed information for the current patient
        function loadPatientDoctorAndBed() {
            const params = new URLSearchParams(window.location.search);
            const patientId = params.get('id') || params.get('patientId');
            
            if (!patientId) {
                return;
            }

            let doctorName = '-';
            let bedInfo = '-';

            // Convert patient ID to number if it's numeric (for matching with patientsData)
            const patientIdNum = parseInt(patientId);
            const isNumericId = !isNaN(patientIdNum);

            // Get appointments data
            const appointments = JSON.parse(localStorage.getItem('hm_appointments_data') || '[]');
            
            // Get patients data from localStorage (if stored)
            const patientsData = JSON.parse(localStorage.getItem('hm_patients_data') || '[]');
            
            // Also check hardcoded patients data structure (same as index.html)
            // This matches the structure used in the dashboard
            const hardcodedPatients = [
                { id: 301, name: 'Careen G. Simpson', age: 35, checkin: '20 July 2028', treatment: 'Routine Check-Up', doctor: 'Dr. Petra Winsbury', room: 'Singleâ303', status: 'Active' },
                { id: 302, name: 'Edgar Warlow', age: 28, checkin: '20 July 2028', treatment: 'Cardiovascular Consultation', doctor: 'Dr. Olivia Martinez', room: 'Singleâ407', status: 'Active' },
                { id: 303, name: 'Ocean Jane Lupre', age: 20, checkin: '20 July 2028', treatment: 'Pediatric Check-Up', doctor: 'Dr. Damian Sanchez', room: 'Doubleâ303', status: 'New Patient' },
                { id: 304, name: 'Shane Riddick', age: 50, checkin: '20 July 2028', treatment: 'Skin Allergy', doctor: 'Dr. Chloe Harrington', room: 'Singleâ305', status: 'Inactive' },
                { id: 305, name: 'Queen Lawiston', age: 60, checkin: '22 July 2028', treatment: 'Follow-Up Visit', doctor: 'Dr. Petra Winsbury', room: 'Singleâ305', status: 'Active' },
                { id: 306, name: 'Alice Mitchell', age: 28, checkin: '20 July 2028', treatment: 'Routine Check-Up', doctor: 'Dr. Emily Smith', room: 'Singleâ305', status: 'Active' },
                { id: 307, name: 'Mikhail Morozov', age: 55, checkin: '22 July 2028', treatment: 'Cardiovascular Consultation', doctor: 'Dr. Samuel Thompson', room: 'Singleâ409', status: 'Active' },
                { id: 308, name: 'Par Desai', age: 40, checkin: '20 July 2028', treatment: 'Skin Allergy', doctor: 'Dr. Luke Hansson', room: 'Singleâ310', status: 'Inactive' },
                { id: 309, name: 'Omar Ali', age: 70, checkin: '20 July 2028', treatment: 'Follow-Up Visit', doctor: 'Dr. Andrew Peterson', room: 'Singleâ310', status: 'Active' },
                { id: 310, name: 'Camila Alvarez', age: 30, checkin: '20 July 2028', treatment: 'Cardiovascular Check-Up', doctor: 'Dr. Olivia Martinez', room: 'Singleâ312', status: 'Active' },
                { id: 311, name: 'Thabo van Rooyen', age: 15, checkin: '20 July 2028', treatment: 'Pediatric Check-Up', doctor: 'Dr. William Carter', room: 'Doubleâ312', status: 'New Patient' },
                { id: 313, name: 'John Doe', age: 31, checkin: '21 July 2028', treatment: 'General Consultation', doctor: 'Dr. Steven Blake', room: 'Singleâ111', status: 'Active' },
                { id: 314, name: 'John Doe', age: 31, checkin: '21 July 2028', treatment: 'General Consultation', doctor: 'Dr. Steven Blake', room: 'Singleâ111', status: 'Active' },
                { id: 315, name: 'John Doe', age: 31, checkin: '21 July 2028', treatment: 'General Consultation', doctor: 'Dr. Steven Blake', room: 'Singleâ111', status: 'Active' }
            ];

            // Combine all patient sources
            const allPatients = [...hardcodedPatients, ...patientsData];

            // Try to find patient by ID (numeric match)
            let foundPatient = null;
            if (isNumericId) {
                foundPatient = allPatients.find(p => p && (p.id === patientIdNum || p.id === patientId || String(p.id) === String(patientId)));
            }
            
            // If not found by ID, try to find by patientId field
            if (!foundPatient) {
                foundPatient = allPatients.find(p => {
                    if (!p) return false;
                    const pId = String(p.patientId || p.id || '').toUpperCase();
                    const searchId = String(patientId).toUpperCase();
                    return pId === searchId || 
                           pId === 'PAT-' + searchId ||
                           'PAT-' + pId === searchId ||
                           pId.replace('PAT-', '') === searchId.replace('PAT-', '');
                });
            }

            // If patient found in patients data, get doctor and bed
            if (foundPatient) {
                if (foundPatient.doctor && foundPatient.doctor.trim()) {
                    doctorName = foundPatient.doctor;
                }
                if (foundPatient.room && foundPatient.room.trim()) {
                    bedInfo = foundPatient.room;
                } else if (foundPatient.bedNumber && foundPatient.bedNumber.trim()) {
                    bedInfo = foundPatient.bedNumber;
                } else if (foundPatient.bed && foundPatient.bed.trim()) {
                    bedInfo = foundPatient.bed;
                }
            }

            // Also check appointments for this patient
            // Match by patient ID or by patient name
            let patientAppointment = null;
            
            if (foundPatient && foundPatient.name) {
                // Try to find appointment by patient name
                patientAppointment = appointments.find(apt => 
                    apt && apt.fullName && apt.fullName.toLowerCase() === foundPatient.name.toLowerCase()
                );
            }
            
            // Also try to match by ID
            if (!patientAppointment && isNumericId) {
                patientAppointment = appointments.find(apt => 
                    apt && (apt.id === patientIdNum || apt.patientId === patientIdNum || String(apt.id) === String(patientId))
                );
            }

            // If appointment found and we don't have doctor/bed yet, use appointment data
            if (patientAppointment) {
                if (doctorName === '-' && patientAppointment.doctor && patientAppointment.doctor.trim()) {
                    doctorName = patientAppointment.doctor;
                } else if (doctorName === '-' && patientAppointment.department && patientAppointment.department.trim()) {
                    doctorName = patientAppointment.department;
                }
                
                if (bedInfo === '-' && patientAppointment.room && patientAppointment.room.trim() && patientAppointment.room !== 'OPD') {
                    bedInfo = patientAppointment.room;
                } else if (bedInfo === '-' && (patientAppointment.visitType === 'OPD' || patientAppointment.source === 'public')) {
                    bedInfo = 'OPD';
                }
            }

            // Update the display
            document.getElementById('pd-doctor').textContent = doctorName;
            document.getElementById('pd-bed').textContent = bedInfo;
        }

        // Load doctor and bed info on page load
        loadPatientDoctorAndBed();

        // Initialize currency selector function (define before use)
        function initCurrencySelector() {
            const container = document.getElementById('currency-selector-bills-container');
            if (container && !container.querySelector('select')) {
                container.innerHTML = CurrencyHelper.createCurrencySelector(null, function(currency) {
                    CurrencyHelper.updateCurrencyDisplays();
                });
            }
            CurrencyHelper.updateCurrencyDisplays();
        }

        // Tabs
        const tabs = document.querySelectorAll('.tab-btn');
        const panels = {
            health: document.getElementById('panel-health'),
            case: document.getElementById('panel-case'),
            attachments: document.getElementById('panel-attachments'),
            bills: document.getElementById('panel-bills'),
            insights: document.getElementById('panel-insights')
        };

        tabs.forEach(btn => btn.addEventListener('click', () => {
            tabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
            tabs.forEach(b => b.classList.add('bg-white','border'));
            btn.classList.add('bg-orange-500','text-white');
            btn.classList.remove('bg-white','border');
            Object.values(panels).forEach(p => p.classList.add('hidden'));
            panels[btn.dataset.tab].classList.remove('hidden');
            
            // Initialize currency selector and load bills when bills panel is shown
            if (btn.dataset.tab === 'bills') {
                setTimeout(() => {
                    initCurrencySelector();
                    loadBills();
                }, 150);
            }
            
            // Initialize medication/tests/radiology tabs when health panel is shown
            if (btn.dataset.tab === 'health') {
                setTimeout(() => {
                    initializeTabs();
                }, 100);
            }
        }));

        // Sub-tabs functionality for Case Sheet
        const subtabs = document.querySelectorAll('.subtab-btn');
        const subpanels = {
            overview: document.getElementById('subpanel-overview'),
            treatment: document.getElementById('subpanel-treatment'),
            prescription: document.getElementById('subpanel-prescription'),
            radiology: document.getElementById('subpanel-radiology'),
            lab: document.getElementById('subpanel-lab'),
            visit: document.getElementById('subpanel-visit')
        };

        subtabs.forEach(btn => btn.addEventListener('click', () => {
            subtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
            subtabs.forEach(b => b.classList.add('bg-white','border'));
            btn.classList.add('bg-orange-500','text-white');
            btn.classList.remove('bg-white','border');
            Object.values(subpanels).forEach(p => p.classList.add('hidden'));
            subpanels[btn.dataset.subtab].classList.remove('hidden');
            
            // Show configure popup when Case Sheet (overview) tab is clicked
            if (btn.dataset.subtab === 'overview') {
                const hasConfig = localStorage.getItem('caseSheetConfig');
                if (!hasConfig) {
                    openConfigureCaseSheet();
                } else {
                    updateCaseSheetDisplay();
                }
            }
        }));

        // Handle URL hash navigation
        function handleHashNavigation() {
            const hash = window.location.hash.substring(1); // Remove the # symbol
            if (hash) {
                // Check if it's a main tab
                if (panels[hash]) {
                    // Switch to the specified main tab
                    const targetTab = document.querySelector(`[data-tab="${hash}"]`);
                    if (targetTab) {
                        // Update main tab appearance
                        tabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
                        tabs.forEach(b => b.classList.add('bg-white','border'));
                        targetTab.classList.add('bg-orange-500','text-white');
                        targetTab.classList.remove('bg-white','border');
                        
                        // Show target panel
                        Object.values(panels).forEach(p => p.classList.add('hidden'));
                        panels[hash].classList.remove('hidden');
                        
                        // Initialize medication/tests/radiology tabs when health panel is shown
                        if (hash === 'health') {
                            setTimeout(() => {
                                initializeTabs();
                            }, 100);
                        }
                        
                        // Load bills when bills panel is shown
                        if (hash === 'bills') {
                            setTimeout(() => {
                                loadBills();
                            }, 100);
                        }
                    }
                }
                // Check if it's a sub-tab
                else if (subpanels[hash]) {
                    // Switch to the specified sub-tab
                    const targetTab = document.querySelector(`[data-subtab="${hash}"]`);
                    if (targetTab) {
                        // Update sub-tab appearance
                        subtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
                        subtabs.forEach(b => b.classList.add('bg-white','border'));
                        targetTab.classList.add('bg-orange-500','text-white');
                        targetTab.classList.remove('bg-white','border');
                        
                        // Show target panel
                        Object.values(subpanels).forEach(p => p.classList.add('hidden'));
                        subpanels[hash].classList.remove('hidden');
                    }
                }
            }
        }

        // Check for hash on page load
        window.addEventListener('load', handleHashNavigation);
        
        // Check for hash changes
        window.addEventListener('hashchange', handleHashNavigation);

        // Load and render bills for the current patient
        function loadBills() {
            const params = new URLSearchParams(window.location.search);
            const patientId = params.get('id') || params.get('patientId');
            
            if (!patientId) {
                document.getElementById('bills-table-body').innerHTML = 
                    '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">No patient ID found</td></tr>';
                return;
            }

            // Get all bills from localStorage
            const allBills = JSON.parse(localStorage.getItem('hm_bills_data') || '[]');
            
            // Filter bills for this specific patient
            // Handle different patient ID formats (with/without PAT- prefix, string/number)
            const patientBills = allBills.filter(bill => {
                if (!bill.patientId) return false;
                
                const billPatientId = bill.patientId.toString().toUpperCase();
                const currentPatientId = patientId.toString().toUpperCase();
                
                // Match exact ID, with PAT- prefix, or without prefix
                return billPatientId === currentPatientId ||
                       billPatientId === 'PAT-' + currentPatientId ||
                       billPatientId === currentPatientId.replace('PAT-', '') ||
                       'PAT-' + billPatientId === currentPatientId ||
                       billPatientId.replace('PAT-', '') === currentPatientId.replace('PAT-', '');
            });

            const tbody = document.getElementById('bills-table-body');
            
            if (patientBills.length === 0) {
                tbody.innerHTML = 
                    '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">No bills found for this patient</td></tr>';
                return;
            }

            // Sort bills by billing date (newest first)
            patientBills.sort((a, b) => new Date(b.billingDate) - new Date(a.billingDate));

            // Render bills
            tbody.innerHTML = patientBills.map((bill, index) => {
                // Format dates
                const billingDate = bill.billingDate ? new Date(bill.billingDate).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }) : '-';
                
                const dueDate = bill.dueDate ? new Date(bill.dueDate).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }) : '-';

                // Format services/line items
                let servicesHtml = '';
                if (bill.lineItems && bill.lineItems.length > 0) {
                    servicesHtml = bill.lineItems.map(item => {
                        const itemDate = item.date ? new Date(item.date).toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric' 
                        }) : '';
                        return `<div class="text-xs mb-1">
                            <span class="font-medium">${item.description || 'Service'}</span>
                            ${itemDate ? `<span class="text-gray-500 ml-1">(${itemDate})</span>` : ''}
                            <span class="text-gray-500 ml-1">Qty: ${item.quantity || 0}</span>
                            <span class="text-gray-500 ml-1">@ ${item.priceFormatted || item.price || 0}</span>
                        </div>`;
                    }).join('');
                } else {
                    servicesHtml = '<span class="text-gray-400 text-xs">No services</span>';
                }

                // Status styling
                let statusClass = '';
                let statusText = bill.billStatus || 'Pending';
                if (statusText.toLowerCase() === 'paid') {
                    statusClass = 'bg-green-100 text-green-700';
                } else if (statusText.toLowerCase() === 'pending' || statusText.toLowerCase() === 'unpaid') {
                    statusClass = 'bg-yellow-100 text-yellow-700';
                } else if (statusText.toLowerCase() === 'overdue') {
                    statusClass = 'bg-red-100 text-red-700';
                } else {
                    statusClass = 'bg-gray-100 text-gray-700';
                }

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${bill.id || 'N/A'}</td>
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-700">${billingDate}</td>
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm text-gray-700">${dueDate}</td>
                        <td class="px-3 sm:px-6 py-4 text-sm text-gray-700">
                            <div class="max-w-xs">${servicesHtml}</div>
                        </td>
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${bill.grandTotalFormatted || bill.grandTotal || '0.00'}
                        </td>
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">
                                ${statusText.toUpperCase()}
                            </span>
                        </td>
                        <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showBillDetails('${bill.id}')" class="px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 text-xs font-medium">
                                View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Show bill details in popup
        function showBillDetails(billId) {
            const allBills = JSON.parse(localStorage.getItem('hm_bills_data') || '[]');
            const bill = allBills.find(b => b.id === billId);
            
            if (!bill) {
                alert('Bill not found');
                return;
            }

            // Format dates
            const billingDate = bill.billingDate ? new Date(bill.billingDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            }) : '-';
            
            const dueDate = bill.dueDate ? new Date(bill.dueDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            }) : '-';

            // Status styling
            let statusClass = '';
            let statusText = bill.billStatus || 'Pending';
            if (statusText.toLowerCase() === 'paid') {
                statusClass = 'bg-green-100 text-green-700';
            } else if (statusText.toLowerCase() === 'pending' || statusText.toLowerCase() === 'unpaid') {
                statusClass = 'bg-yellow-100 text-yellow-700';
            } else if (statusText.toLowerCase() === 'overdue') {
                statusClass = 'bg-red-100 text-red-700';
            } else {
                statusClass = 'bg-gray-100 text-gray-700';
            }

            // Build line items HTML
            let lineItemsHtml = '';
            if (bill.lineItems && bill.lineItems.length > 0) {
                lineItemsHtml = bill.lineItems.map((item, index) => {
                    const itemDate = item.date ? new Date(item.date).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    }) : '-';
                    return `
                        <tr class="border-b">
                            <td class="px-4 py-3 text-sm">${index + 1}</td>
                            <td class="px-4 py-3 text-sm">${item.description || '-'}</td>
                            <td class="px-4 py-3 text-sm text-gray-600">${itemDate}</td>
                            <td class="px-4 py-3 text-sm text-center">${item.quantity || 0}</td>
                            <td class="px-4 py-3 text-sm text-right">${item.priceFormatted || item.price || '0.00'}</td>
                            <td class="px-4 py-3 text-sm text-right font-medium">${item.totalFormatted || item.total || '0.00'}</td>
                        </tr>
                    `;
                }).join('');
            } else {
                lineItemsHtml = '<tr><td colspan="6" class="px-4 py-3 text-center text-gray-500">No line items</td></tr>';
            }

            // Build bill details HTML
            const billDetailsHtml = `
                <!-- Bill Header -->
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Bill Number</p>
                            <p class="text-lg font-semibold text-gray-800">${bill.id || 'N/A'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Patient Name</p>
                            <p class="text-lg font-semibold text-gray-800">${bill.patientName || 'N/A'}</p>
                        </div>
                    </div>
                </div>

                <!-- Bill Information -->
                <div class="bg-white border rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-800 mb-3">Bill Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-gray-500 mb-1">Billing Date</p>
                            <p class="text-gray-800 font-medium">${billingDate}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 mb-1">Due Date</p>
                            <p class="text-gray-800 font-medium">${dueDate}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 mb-1">Status</p>
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${statusClass} inline-block">
                                ${statusText.toUpperCase()}
                            </span>
                        </div>
                        <div>
                            <p class="text-gray-500 mb-1">Currency</p>
                            <p class="text-gray-800 font-medium">${bill.currency || 'INR'}</p>
                        </div>
                    </div>
                </div>

                <!-- Line Items -->
                <div class="bg-white border rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-800 mb-3">Services & Items</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Service Description</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Quantity</th>
                                    <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Price</th>
                                    <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${lineItemsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Bill Summary -->
                <div class="bg-white border rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-3">Bill Summary</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Subtotal:</span>
                            <span class="text-gray-800 font-medium">${bill.subtotalFormatted || bill.subtotal || '0.00'}</span>
                        </div>
                        ${bill.discountPercent > 0 ? `
                        <div class="flex justify-between">
                            <span class="text-gray-600">Discount (${bill.discountPercent}%):</span>
                            <span class="text-gray-800 font-medium">-${bill.discountAmountFormatted || bill.discountAmount || '0.00'}</span>
                        </div>
                        ` : ''}
                        ${bill.taxPercent > 0 ? `
                        <div class="flex justify-between">
                            <span class="text-gray-600">Tax (${bill.taxPercent}%):</span>
                            <span class="text-gray-800 font-medium">+${bill.taxAmountFormatted || bill.taxAmount || '0.00'}</span>
                        </div>
                        ` : ''}
                        <div class="flex justify-between pt-2 border-t border-gray-200">
                            <span class="text-lg font-semibold text-gray-800">Grand Total:</span>
                            <span class="text-lg font-semibold text-orange-600">${bill.grandTotalFormatted || bill.grandTotal || '0.00'}</span>
                        </div>
                    </div>
                </div>
            `;

            // Populate modal content
            document.getElementById('bill-details-content').innerHTML = billDetailsHtml;
            
            // Store bill data for printing
            window.currentBillForPrint = bill;
            
            // Open modal
            openModal('bill-details-modal');
        }

        // Print bill function
        function printBill() {
            const bill = window.currentBillForPrint;
            if (!bill) {
                alert('No bill data available for printing');
                return;
            }

            // Format dates
            const billingDate = bill.billingDate ? new Date(bill.billingDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            }) : '-';
            
            const dueDate = bill.dueDate ? new Date(bill.dueDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            }) : '-';

            // Build line items HTML for print
            let lineItemsHtml = '';
            if (bill.lineItems && bill.lineItems.length > 0) {
                lineItemsHtml = bill.lineItems.map((item, index) => {
                    const itemDate = item.date ? new Date(item.date).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    }) : '-';
                    return `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 12px; text-align: left;">${index + 1}</td>
                            <td style="padding: 12px; text-align: left;">${item.description || '-'}</td>
                            <td style="padding: 12px; text-align: left; color: #4b5563;">${itemDate}</td>
                            <td style="padding: 12px; text-align: center;">${item.quantity || 0}</td>
                            <td style="padding: 12px; text-align: right;">${item.priceFormatted || item.price || '0.00'}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 500;">${item.totalFormatted || item.total || '0.00'}</td>
                        </tr>
                    `;
                }).join('');
            } else {
                lineItemsHtml = '<tr><td colspan="6" style="padding: 12px; text-align: center; color: #6b7280;">No line items</td></tr>';
            }

            // Create print-friendly HTML
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Bill - ${bill.id || 'N/A'}</title>
                    <style>
                        @media print {
                            @page {
                                margin: 20mm;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                            }
                        }
                        body {
                            font-family: Arial, sans-serif;
                            color: #1f2937;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 20px;
                        }
                        .header {
                            background-color: #fff7ed;
                            border: 1px solid #fed7aa;
                            border-radius: 8px;
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .header-row {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 10px;
                        }
                        .header-label {
                            font-size: 12px;
                            color: #6b7280;
                            margin-bottom: 4px;
                        }
                        .header-value {
                            font-size: 18px;
                            font-weight: 600;
                            color: #1f2937;
                        }
                        .section {
                            background-color: #ffffff;
                            border: 1px solid #e5e7eb;
                            border-radius: 8px;
                            padding: 20px;
                            margin-bottom: 20px;
                        }
                        .section-title {
                            font-weight: 600;
                            color: #1f2937;
                            margin-bottom: 15px;
                            font-size: 16px;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            font-size: 14px;
                        }
                        .info-label {
                            color: #6b7280;
                            margin-bottom: 4px;
                        }
                        .info-value {
                            color: #1f2937;
                            font-weight: 500;
                        }
                        .status-badge {
                            display: inline-block;
                            padding: 4px 12px;
                            border-radius: 9999px;
                            font-size: 12px;
                            font-weight: 500;
                            text-transform: uppercase;
                        }
                        .status-paid { background-color: #d1fae5; color: #065f46; }
                        .status-pending { background-color: #fef3c7; color: #92400e; }
                        .status-overdue { background-color: #fee2e2; color: #991b1b; }
                        .status-default { background-color: #f3f4f6; color: #374151; }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 10px;
                        }
                        th {
                            background-color: #f9fafb;
                            padding: 12px;
                            text-align: left;
                            font-size: 12px;
                            font-weight: 500;
                            color: #6b7280;
                            text-transform: uppercase;
                            border-bottom: 1px solid #e5e7eb;
                        }
                        th.text-center { text-align: center; }
                        th.text-right { text-align: right; }
                        td {
                            padding: 12px;
                        }
                        .summary {
                            margin-top: 20px;
                        }
                        .summary-row {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 8px;
                            font-size: 14px;
                        }
                        .summary-label {
                            color: #4b5563;
                        }
                        .summary-value {
                            color: #1f2937;
                            font-weight: 500;
                        }
                        .summary-total {
                            padding-top: 12px;
                            border-top: 1px solid #e5e7eb;
                            margin-top: 12px;
                        }
                        .summary-total-label {
                            font-size: 18px;
                            font-weight: 600;
                            color: #1f2937;
                        }
                        .summary-total-value {
                            font-size: 18px;
                            font-weight: 600;
                            color: #ea580c;
                        }
                        .print-date {
                            text-align: right;
                            color: #6b7280;
                            font-size: 12px;
                            margin-bottom: 20px;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-date">Printed on: ${new Date().toLocaleString()}</div>
                    
                    <div class="header">
                        <div class="header-row">
                            <div>
                                <div class="header-label">Bill Number</div>
                                <div class="header-value">${bill.id || 'N/A'}</div>
                            </div>
                            <div>
                                <div class="header-label">Patient Name</div>
                                <div class="header-value">${bill.patientName || 'N/A'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Bill Information</div>
                        <div class="info-grid">
                            <div>
                                <div class="info-label">Billing Date</div>
                                <div class="info-value">${billingDate}</div>
                            </div>
                            <div>
                                <div class="info-label">Due Date</div>
                                <div class="info-value">${dueDate}</div>
                            </div>
                            <div>
                                <div class="info-label">Status</div>
                                <div>
                                    <span class="status-badge status-${(bill.billStatus || 'pending').toLowerCase()}">
                                        ${(bill.billStatus || 'Pending').toUpperCase()}
                                    </span>
                                </div>
                            </div>
                            <div>
                                <div class="info-label">Currency</div>
                                <div class="info-value">${bill.currency || 'INR'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Services & Items</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Service Description</th>
                                    <th>Date</th>
                                    <th class="text-center">Quantity</th>
                                    <th class="text-right">Price</th>
                                    <th class="text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${lineItemsHtml}
                            </tbody>
                        </table>
                    </div>

                    <div class="section">
                        <div class="section-title">Bill Summary</div>
                        <div class="summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value">${bill.subtotalFormatted || bill.subtotal || '0.00'}</span>
                            </div>
                            ${bill.discountPercent > 0 ? `
                            <div class="summary-row">
                                <span class="summary-label">Discount (${bill.discountPercent}%):</span>
                                <span class="summary-value">-${bill.discountAmountFormatted || bill.discountAmount || '0.00'}</span>
                            </div>
                            ` : ''}
                            ${bill.taxPercent > 0 ? `
                            <div class="summary-row">
                                <span class="summary-label">Tax (${bill.taxPercent}%):</span>
                                <span class="summary-value">+${bill.taxAmountFormatted || bill.taxAmount || '0.00'}</span>
                            </div>
                            ` : ''}
                            <div class="summary-row summary-total">
                                <span class="summary-total-label">Grand Total:</span>
                                <span class="summary-total-value">${bill.grandTotalFormatted || bill.grandTotal || '0.00'}</span>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `;

            // Open print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for content to load, then print
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                }, 250);
            };
        }

        // Load bills when bills panel is shown
        function handleBillsPanelShow() {
            const billsPanel = document.getElementById('panel-bills');
            if (billsPanel && !billsPanel.classList.contains('hidden')) {
                loadBills();
            }
        }

        // Call loadBills when bills tab is clicked
        const billsTab = document.querySelector('[data-tab="bills"]');
        if (billsTab) {
            billsTab.addEventListener('click', () => {
                setTimeout(loadBills, 100);
            });
        }

        // Also load bills on page load if hash is #bills
        if (window.location.hash === '#bills') {
            setTimeout(loadBills, 300);
        }

        // Lab Reports Sub-tabs functionality
        const labSubtabs = document.querySelectorAll('.lab-subtab-btn');
        const labSubpanels = {
            'lab-order': document.getElementById('lab-subpanel-order'),
            'test-wise': document.getElementById('lab-subpanel-test')
        };

        labSubtabs.forEach(btn => btn.addEventListener('click', () => {
            labSubtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
            labSubtabs.forEach(b => b.classList.add('bg-white','border'));
            btn.classList.add('bg-orange-500','text-white');
            btn.classList.remove('bg-white','border');
            // Hide all lab subpanels using both class and style
            Object.values(labSubpanels).forEach(p => {
                if (p) {
                    p.classList.add('hidden');
                    p.style.display = 'none';
                }
            });
            // Show selected lab subpanel
            const selectedPanel = labSubpanels[btn.dataset.labSubtab];
            if (selectedPanel) {
                selectedPanel.classList.remove('hidden');
                selectedPanel.style.display = 'block';
            }
        }));

        // Radiology Sub-tabs functionality
        const radioSubtabs = document.querySelectorAll('.radio-subtab-btn');
        const radioSubpanels = {
            'radiology': document.getElementById('radio-subpanel-radiology'),
            'all-orders': document.getElementById('radio-subpanel-all-orders')
        };

        if (radioSubtabs.length > 0) {
            radioSubtabs.forEach(btn => btn.addEventListener('click', () => {
                radioSubtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
                radioSubtabs.forEach(b => b.classList.add('bg-white','border'));
                btn.classList.add('bg-orange-500','text-white');
                btn.classList.remove('bg-white','border');
                // Hide all radiology subpanels using both class and style
                Object.values(radioSubpanels).forEach(p => {
                    if (p) {
                        p.classList.add('hidden');
                        p.style.display = 'none';
                    }
                });
                // Show selected radiology subpanel
                const selectedPanel = radioSubpanels[btn.dataset.radioSubtab];
                if (selectedPanel) {
                    selectedPanel.classList.remove('hidden');
                    selectedPanel.style.display = 'block';
                }
            }));
        }

        // Clinical Insights Sub-tabs functionality
        const insightSubtabs = document.querySelectorAll('.insight-subtab-btn');
        const insightSubpanels = {
            'lists': document.getElementById('insight-subpanel-lists'),
            'charts': document.getElementById('insight-subpanel-charts')
        };

        insightSubtabs.forEach(btn => btn.addEventListener('click', () => {
            insightSubtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
            insightSubtabs.forEach(b => b.classList.add('bg-white','border'));
            btn.classList.add('bg-orange-500','text-white');
            btn.classList.remove('bg-white','border');
            Object.values(insightSubpanels).forEach(p => p.classList.add('hidden'));
            insightSubpanels[btn.dataset.insightSubtab].classList.remove('hidden');
        }));

        // Generic modal helpers
        function openModal(id){ const m=document.getElementById(id); if(m){ m.classList.remove('hidden'); m.classList.add('flex'); }}
        function closeModal(id){ const m=document.getElementById(id); if(m){ m.classList.add('hidden'); m.classList.remove('flex'); }}
        document.querySelectorAll('[data-close]')?.forEach(btn=>{
            btn.addEventListener('click', ()=> closeModal(btn.getAttribute('data-close')));
        });
        const addRecordBtn = document.getElementById('open-add-record');
        if(addRecordBtn){ addRecordBtn.addEventListener('click', ()=> openModal('add-record-modal')); }
        const openTarget = document.getElementById('open-target');
        const openTarget2 = document.getElementById('open-target-2');
        if(openTarget){ openTarget.addEventListener('click', ()=> openModal('target-modal')); }
        if(openTarget2){ openTarget2.addEventListener('click', ()=> openModal('target-modal')); }
        const openHistory = document.getElementById('open-history');
        const openHistory2 = document.getElementById('open-history-2');
        if(openHistory){ openHistory.addEventListener('click', ()=> { openModal('history-modal'); drawHistoryChart(); }); }
        if(openHistory2){ openHistory2.addEventListener('click', ()=> { openModal('history-modal'); drawHistoryChart(); }); }

        // History chart
        function drawHistoryChart(){
            const ctx = document.getElementById('historyChart');
            if(!ctx) return;
            // Destroy existing chart if re-opened
            if(window._historyChart){ window._historyChart.destroy(); }
            window._historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon Sep 4 2023','Mon Dec 4 2023','Tue Feb 6 2024','Tue Mar 6 2024','Thu Jul 4 2024'],
                    datasets: [{
                        label: 'Value',
                        data: [50, 38, 9, 20, 45],
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-500') || '#f97316',
                        backgroundColor: 'transparent',
                        pointBackgroundColor: '#fff',
                        pointBorderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-500') || '#f97316',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'right' } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Set default active tab and sub-tab
        document.addEventListener('DOMContentLoaded', function() {
            // Set Case Sheet as active by default
            const caseTab = document.querySelector('.tab-btn[data-tab="case"]');
            if (caseTab) {
                tabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
                tabs.forEach(b => b.classList.add('bg-white','border'));
                caseTab.classList.add('bg-orange-500','text-white');
                caseTab.classList.remove('bg-white','border');
                Object.values(panels).forEach(p => p.classList.add('hidden'));
                panels['case'].classList.remove('hidden');
                
                // Set Case Sheet overview as active sub-tab
                const overviewSubTab = document.querySelector('.subtab-btn[data-subtab="overview"]');
                if (overviewSubTab) {
                    subtabs.forEach(b => b.classList.remove('bg-orange-500','text-white'));
                    subtabs.forEach(b => b.classList.add('bg-white','border'));
                    overviewSubTab.classList.add('bg-orange-500','text-white');
                    overviewSubTab.classList.remove('bg-white','border');
                    Object.values(subpanels).forEach(p => p.classList.add('hidden'));
                    subpanels['overview'].classList.remove('hidden');
                }
            }
        });
    </script>

    <!-- Settings Modal shared -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Theme Settings</h3>
                <button id="close-settings" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Accent Color</label>
                    <input id="accent-picker" type="color" value="#f97316" class="w-16 h-10 p-0 border rounded cursor-pointer">
                    <p class="text-xs text-gray-500 mt-2">Changes all orange accents (buttons, pills, borders).</p>
                </div>
                <div class="flex items-center justify-end space-x-2">
                    <button id="reset-theme" class="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Reset</button>
                    <button id="save-theme" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // THEME ENGINE (same as index)
        function setAccentFromHex(hex){
            const root = document.documentElement;
            root.style.setProperty('--accent-500', hex);
            const h = hex.replace('#','');
            const r = parseInt(h.substring(0,2),16), g=parseInt(h.substring(2,4),16), b=parseInt(h.substring(4,6),16);
            function shadeTowardsWhite(f){ return `rgb(${Math.round(r+(255-r)*f)}, ${Math.round(g+(255-g)*f)}, ${Math.round(b+(255-b)*f)})`; }
            function darken(f){ return `rgb(${Math.round(r*(1-f))}, ${Math.round(g*(1-f))}, ${Math.round(b*(1-f))})`; }
            root.style.setProperty('--accent-600', darken(0.12));
            root.style.setProperty('--accent-700', darken(0.25));
            root.style.setProperty('--accent-400', shadeTowardsWhite(0.15));
            root.style.setProperty('--accent-300', shadeTowardsWhite(0.30));
            root.style.setProperty('--accent-200', shadeTowardsWhite(0.50));
            root.style.setProperty('--accent-100', shadeTowardsWhite(0.70));
            root.style.setProperty('--accent-50', shadeTowardsWhite(0.85));
        }
        function loadTheme(){ const saved = localStorage.getItem('hm_accent_hex'); if(saved){ setAccentFromHex(saved); const p=document.getElementById('accent-picker'); if(p) p.value=saved; }}
        function saveTheme(hex){ localStorage.setItem('hm_accent_hex', hex); }
        const settingsModal = document.getElementById('settings-modal');
        const openBtn = document.getElementById('open-settings-pd');
        const closeBtn = document.getElementById('close-settings');
        const saveBtn = document.getElementById('save-theme');
        const resetBtn = document.getElementById('reset-theme');
        const picker = document.getElementById('accent-picker');
        if(openBtn){ openBtn.addEventListener('click', ()=>{ settingsModal.classList.remove('hidden'); settingsModal.classList.add('flex'); loadTheme(); }); }
        if(closeBtn){ closeBtn.addEventListener('click', ()=>{ settingsModal.classList.add('hidden'); settingsModal.classList.remove('flex'); }); }
        if(saveBtn){ saveBtn.addEventListener('click', ()=>{ const hex = picker.value; setAccentFromHex(hex); saveTheme(hex); settingsModal.classList.add('hidden'); settingsModal.classList.remove('flex'); }); }
        if(resetBtn){ resetBtn.addEventListener('click', ()=>{ localStorage.removeItem('hm_accent_hex'); location.reload(); }); }
        loadTheme();

        // Medication functionality
        function addMedicine() {
            const medicationList = document.getElementById('medication-list');
            
            // Get the current first row (if it exists)
            const currentFirstRow = medicationList.firstElementChild;
            
            // Change the current first row's plus button to minus button (if it exists)
            if (currentFirstRow) {
                const firstButton = currentFirstRow.querySelector('button');
                if (firstButton && firstButton.innerHTML.includes('fa-plus')) {
                    firstButton.innerHTML = '<i class="fas fa-minus"></i>';
                    firstButton.className = 'px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600';
                    firstButton.setAttribute('onclick', 'removeMedicine(this)');
                }
            }
            
            // Create new row with plus button
            const newMedicineRow = document.createElement('div');
            newMedicineRow.className = 'flex flex-wrap items-center gap-2';
            newMedicineRow.innerHTML = `
                <div class="flex-1 min-w-[120px] relative">
                    <input type="text" name="medicine[]" list="medicine-list-options" class="w-full border border-gray-300 rounded px-3 py-2 text-sm pr-8" placeholder="Search medicine..." autocomplete="off" />
                    <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                </div>
                <input type="number" name="morning[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Morning" min="0" />
                <input type="number" name="afternoon[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Afternoon" min="0" />
                <input type="number" name="night[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Night" min="0" />
                <input type="text" name="duration[]" class="w-20 sm:w-20 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Duration" />
                <button type="button" onclick="addMedicine()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                    <i class="fas fa-plus"></i>
                </button>
            `;
            
            // Insert at the TOP (as first child)
            if (medicationList.firstElementChild) {
                medicationList.insertBefore(newMedicineRow, medicationList.firstElementChild);
            } else {
                medicationList.appendChild(newMedicineRow);
            }
        }

        function removeMedicine(button) {
            button.parentElement.remove();
        }

        // Tab switching functionality
        let tabsInitialized = false;
        function initializeTabs() {
            // Only initialize if health panel is visible
            const healthPanel = document.getElementById('panel-health');
            if (healthPanel && healthPanel.classList.contains('hidden')) {
                return; // Health panel is hidden, don't initialize
            }
            
            const tabButtons = document.querySelectorAll('[data-tab="medication"], [data-tab="tests"], [data-tab="radiology"]');
            const tabContents = document.querySelectorAll('.tab-content');
            
            if (tabButtons.length === 0 || tabContents.length === 0) {
                return; // Elements not found yet
            }
            
            // Initialize: Set Medication as active by default - be very explicit
            const medicationBtn = document.querySelector('[data-tab="medication"]');
            const testsBtn = document.querySelector('[data-tab="tests"]');
            const radiologyBtn = document.querySelector('[data-tab="radiology"]');
            
            if (medicationBtn) {
                medicationBtn.classList.add('border-b-2', 'border-orange-500', 'text-orange-500', 'font-semibold');
                medicationBtn.classList.remove('text-gray-500', 'border-transparent');
            }
            if (testsBtn) {
                testsBtn.classList.add('text-gray-500', 'border-b-2', 'border-transparent');
                testsBtn.classList.remove('border-orange-500', 'text-orange-500', 'font-semibold');
            }
            if (radiologyBtn) {
                radiologyBtn.classList.add('text-gray-500', 'border-b-2', 'border-transparent');
                radiologyBtn.classList.remove('border-orange-500', 'text-orange-500', 'font-semibold');
            }
            
            // Hide all tab contents except medication - be very explicit
            const medicationContent = document.getElementById('tab-content-medication');
            const testsContent = document.getElementById('tab-content-tests');
            const radiologyContent = document.getElementById('tab-content-radiology');
            
            if (medicationContent) {
                medicationContent.classList.remove('hidden');
            }
            if (testsContent) {
                testsContent.classList.add('hidden');
            }
            if (radiologyContent) {
                radiologyContent.classList.add('hidden');
            }
            
            // Add click handlers only once
            if (!tabsInitialized) {
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        
                        // Remove active styles from all tabs
                        tabButtons.forEach(btn => {
                            btn.classList.remove('border-orange-500', 'text-orange-500', 'font-semibold');
                            btn.classList.add('text-gray-500', 'border-transparent');
                        });
                        
                        // Hide all tab contents
                        tabContents.forEach(content => {
                            content.classList.add('hidden');
                        });
                        
                        // Show selected tab content
                        const targetContent = document.getElementById(`tab-content-${targetTab}`);
                        if (targetContent) {
                            targetContent.classList.remove('hidden');
                        }
                        
                        // Add active styles to clicked tab
                        this.classList.remove('text-gray-500', 'border-transparent');
                        this.classList.add('border-b-2', 'border-orange-500', 'text-orange-500', 'font-semibold');
                    });
                });
                tabsInitialized = true;
            }
        }
        
        // Initialize tabs on page load - multiple attempts to ensure it runs
        function runTabInitialization() {
            initializeTabs();
        }
        
        // Try multiple times to ensure it works
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTabInitialization);
        } else {
            runTabInitialization();
        }
        
        // Additional fallbacks
        window.addEventListener('load', runTabInitialization);
        setTimeout(runTabInitialization, 100);
        setTimeout(runTabInitialization, 300);
        setTimeout(runTabInitialization, 500);

        // Tests functionality
        function addTest() {
            const testsList = document.getElementById('tests-list');
            const currentFirstRow = testsList.firstElementChild;
            
            if (currentFirstRow) {
                const firstButton = currentFirstRow.querySelector('button');
                if (firstButton && firstButton.innerHTML.includes('fa-plus')) {
                    firstButton.innerHTML = '<i class="fas fa-minus"></i>';
                    firstButton.className = 'px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600';
                    firstButton.setAttribute('onclick', 'removeTest(this)');
                }
            }
            
            const newTestRow = document.createElement('div');
            newTestRow.className = 'flex flex-wrap items-center gap-2';
            newTestRow.innerHTML = `
                <select name="testType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                    <option value="">Select Test</option>
                    <option value="Blood Count Tests">Blood Count Tests</option>
                    <option value="Genetic Testing">Genetic Testing</option>
                    <option value="Kidney Tests">Kidney Tests</option>
                    <option value="Laboratory Tests">Laboratory Tests</option>
                    <option value="Prenatal Testing">Prenatal Testing</option>
                    <option value="Thyroid Tests">Thyroid Tests</option>
                    <option value="Urinalysis">Urinalysis</option>
                </select>
                <input type="text" name="testNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                <button type="button" onclick="addTest()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                    <i class="fas fa-plus"></i>
                </button>
            `;
            
            if (testsList.firstElementChild) {
                testsList.insertBefore(newTestRow, testsList.firstElementChild);
            } else {
                testsList.appendChild(newTestRow);
            }
        }

        function removeTest(button) {
            button.parentElement.remove();
        }

        // Radiology functionality
        function addRadiology() {
            const radiologyList = document.getElementById('radiology-list');
            const currentFirstRow = radiologyList.firstElementChild;
            
            if (currentFirstRow) {
                const firstButton = currentFirstRow.querySelector('button');
                if (firstButton && firstButton.innerHTML.includes('fa-plus')) {
                    firstButton.innerHTML = '<i class="fas fa-minus"></i>';
                    firstButton.className = 'px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600';
                    firstButton.setAttribute('onclick', 'removeRadiology(this)');
                }
            }
            
            const newRadiologyRow = document.createElement('div');
            newRadiologyRow.className = 'flex flex-wrap items-center gap-2';
            newRadiologyRow.innerHTML = `
                <select name="radiologyType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                    <option value="">Select Radiology Test</option>
                    <option value="X-Ray">X-Ray</option>
                    <option value="CT Scan">CT Scan</option>
                    <option value="MRI">MRI</option>
                    <option value="Ultrasound">Ultrasound</option>
                    <option value="Mammography">Mammography</option>
                    <option value="Bone Scan">Bone Scan</option>
                    <option value="PET Scan">PET Scan</option>
                </select>
                <input type="text" name="radiologyBodyPart[]" class="w-28 sm:w-32 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Body Part" />
                <input type="text" name="radiologyNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                <button type="button" onclick="addRadiology()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                    <i class="fas fa-plus"></i>
                </button>
            `;
            
            if (radiologyList.firstElementChild) {
                radiologyList.insertBefore(newRadiologyRow, radiologyList.firstElementChild);
            } else {
                radiologyList.appendChild(newRadiologyRow);
            }
        }

        function removeRadiology(button) {
            button.parentElement.remove();
        }

        function clearForm() {
            document.getElementById('add-record-form').reset();
            
            // Reset medication list to single row
            const medicationList = document.getElementById('medication-list');
            medicationList.innerHTML = `
                <div class="flex flex-wrap items-center gap-2">
                    <div class="flex-1 min-w-[120px] relative">
                        <input type="text" name="medicine[]" list="medicine-list-options" class="w-full border border-gray-300 rounded px-3 py-2 text-sm pr-8" placeholder="Search medicine..." autocomplete="off" />
                        <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                    </div>
                    <input type="number" name="morning[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Morning" min="0" />
                    <input type="number" name="afternoon[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Afternoon" min="0" />
                    <input type="number" name="night[]" class="w-16 sm:w-16 border border-gray-300 rounded px-2 py-2 text-sm" placeholder="Night" min="0" />
                    <input type="text" name="duration[]" class="w-20 sm:w-20 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Duration" />
                    <button type="button" onclick="addMedicine()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `;
            
            // Reset tests list to single row
            const testsList = document.getElementById('tests-list');
            testsList.innerHTML = `
                <div class="flex flex-wrap items-center gap-2">
                    <select name="testType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                        <option value="">Select Test</option>
                        <option value="Blood Count Tests">Blood Count Tests</option>
                        <option value="Genetic Testing">Genetic Testing</option>
                        <option value="Kidney Tests">Kidney Tests</option>
                        <option value="Laboratory Tests">Laboratory Tests</option>
                        <option value="Prenatal Testing">Prenatal Testing</option>
                        <option value="Thyroid Tests">Thyroid Tests</option>
                        <option value="Urinalysis">Urinalysis</option>
                    </select>
                    <input type="text" name="testNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                    <button type="button" onclick="addTest()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `;
            
            // Reset radiology list to single row
            const radiologyList = document.getElementById('radiology-list');
            radiologyList.innerHTML = `
                <div class="flex flex-wrap items-center gap-2">
                    <select name="radiologyType[]" class="flex-1 min-w-[150px] border border-gray-300 rounded px-3 py-2 text-sm">
                        <option value="">Select Radiology Test</option>
                        <option value="X-Ray">X-Ray</option>
                        <option value="CT Scan">CT Scan</option>
                        <option value="MRI">MRI</option>
                        <option value="Ultrasound">Ultrasound</option>
                        <option value="Mammography">Mammography</option>
                        <option value="Bone Scan">Bone Scan</option>
                        <option value="PET Scan">PET Scan</option>
                    </select>
                    <input type="text" name="radiologyBodyPart[]" class="w-28 sm:w-32 border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Body Part" />
                    <input type="text" name="radiologyNotes[]" class="flex-1 min-w-[120px] border border-gray-300 rounded px-3 py-2 text-sm" placeholder="Notes (optional)" />
                    <button type="button" onclick="addRadiology()" class="px-3 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex-shrink-0">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `;
            
            // Reset to medication tab
            const tabButtons = document.querySelectorAll('[data-tab]');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(btn => {
                const tabName = btn.getAttribute('data-tab');
                if (tabName === 'medication') {
                    btn.classList.remove('text-gray-500', 'border-transparent');
                    btn.classList.add('border-b-2', 'border-orange-500', 'text-orange-500', 'font-semibold');
                } else {
                    btn.classList.remove('border-orange-500', 'text-orange-500', 'font-semibold');
                    btn.classList.add('text-gray-500', 'border-b-2', 'border-transparent');
                }
            });
            tabContents.forEach(content => {
                if (content.id === 'tab-content-medication') {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        }

        // Form submission
        document.getElementById('add-record-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            // Collect medication data
            const medicines = [];
            const medicineNames = formData.getAll('medicine[]');
            const mornings = formData.getAll('morning[]');
            const afternoons = formData.getAll('afternoon[]');
            const nights = formData.getAll('night[]');
            const durations = formData.getAll('duration[]');
            
            for (let i = 0; i < medicineNames.length; i++) {
                if (medicineNames[i].trim()) {
                    medicines.push({
                        name: medicineNames[i],
                        morning: mornings[i] || '',
                        afternoon: afternoons[i] || '',
                        night: nights[i] || '',
                        duration: durations[i] || ''
                    });
                }
            }
            
            // Collect tests data
            const tests = [];
            const testTypes = formData.getAll('testType[]');
            const testNotes = formData.getAll('testNotes[]');
            
            for (let i = 0; i < testTypes.length; i++) {
                if (testTypes[i].trim()) {
                    tests.push({
                        type: testTypes[i],
                        notes: testNotes[i] || ''
                    });
                }
            }
            
            // Collect radiology data
            const radiology = [];
            const radiologyTypes = formData.getAll('radiologyType[]');
            const radiologyBodyParts = formData.getAll('radiologyBodyPart[]');
            const radiologyNotes = formData.getAll('radiologyNotes[]');
            
            for (let i = 0; i < radiologyTypes.length; i++) {
                if (radiologyTypes[i].trim()) {
                    radiology.push({
                        type: radiologyTypes[i],
                        bodyPart: radiologyBodyParts[i] || '',
                        notes: radiologyNotes[i] || ''
                    });
                }
            }
            
            const record = {
                visitDateTime: formData.get('visitDateTime'),
                doctorDepartment: formData.get('doctorDepartment'),
                doctor: formData.get('doctor'),
                diagnosis: formData.get('diagnosis'),
                symptoms: formData.get('symptoms'),
                medicines: medicines,
                tests: tests,
                radiology: radiology,
                notes: formData.get('notes'),
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage (mock)
            let records = JSON.parse(localStorage.getItem('patient_records') || '[]');
            records.push(record);
            localStorage.setItem('patient_records', JSON.stringify(records));
            
            // Update medication display table
            updateMedicationDisplay(medicines);
            
            alert('Record added successfully!');
            clearForm();
        });

        // Function to update medication display table
        function updateMedicationDisplay(medicines) {
            const tbody = document.getElementById('medication-display-tbody');
            if (!tbody) {
                console.error('medication-display-tbody not found');
                return;
            }
            
            if (!medicines || medicines.length === 0) {
                console.log('No medicines to display');
                return;
            }
            
            // Append new rows for each medicine
            medicines.forEach(medicine => {
                if (medicine.name && medicine.name.trim()) {
                    // Format dose as "morning+afternoon+night"
                    const morning = medicine.morning || '0';
                    const afternoon = medicine.afternoon || '0';
                    const night = medicine.night || '0';
                    const dose = `${morning}+${afternoon}+${night}`;
                    const duration = medicine.duration || '-';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2 whitespace-nowrap">${medicine.name}</td>
                        <td class="whitespace-nowrap">${dose}</td>
                        <td class="whitespace-nowrap">${duration}</td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        // Configure Case Sheet functionality
        function openConfigureCaseSheet() {
            document.getElementById('configure-case-sheet-modal').classList.remove('hidden');
            loadCaseSheetConfig();
        }

        function closeConfigureCaseSheet() {
            document.getElementById('configure-case-sheet-modal').classList.add('hidden');
        }

        function loadCaseSheetConfig() {
            const config = JSON.parse(localStorage.getItem('caseSheetConfig') || '{}');
            const checkboxes = [
                'case-vitals', 'case-complaints', 'case-examination', 'case-investigation',
                'case-diagnosis', 'case-prescription', 'case-therapy', 'case-instructions',
                'case-tooth-chart', 'case-daycare', 'case-visit-summary', 'case-vaccine',
                'case-brand-list', 'case-treatment-plan', 'case-nurse-notes'
            ];
            
            // If no config exists, set all to checked by default
            const hasConfig = Object.keys(config).length > 0;
            
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = hasConfig ? (config[id] || false) : true;
                }
            });
            
            // Update Select All checkbox
            const selectAllCheckbox = document.getElementById('select-all-sections');
            if (selectAllCheckbox) {
                const allChecked = checkboxes.every(id => {
                    const checkbox = document.getElementById(id);
                    return checkbox && checkbox.checked;
                });
                selectAllCheckbox.checked = allChecked;
            }
            
            updateSaveButton();
        }

        function saveCaseSheetConfig() {
            const config = {};
            const checkboxes = [
                'case-vitals', 'case-complaints', 'case-examination', 'case-investigation',
                'case-diagnosis', 'case-prescription', 'case-therapy', 'case-instructions',
                'case-tooth-chart', 'case-daycare', 'case-visit-summary', 'case-vaccine',
                'case-brand-list', 'case-treatment-plan', 'case-nurse-notes'
            ];
            
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    config[id] = checkbox.checked;
                }
            });
            
            localStorage.setItem('caseSheetConfig', JSON.stringify(config));
            updateCaseSheetDisplay();
            closeConfigureCaseSheet();
        }

        function updateCaseSheetDisplay() {
            const config = JSON.parse(localStorage.getItem('caseSheetConfig') || '{}');
            const caseSheetContent = document.getElementById('case-sheet-content');
            
            if (!caseSheetContent) return;
            
            // Clear existing content
            caseSheetContent.innerHTML = '';
            
            // Define section data
            const sectionData = {
                'case-vitals': { name: 'Vitals', content: 'Blood Pressure: 120/80, Heart Rate: 72 bpm, Temperature: 98.6Â°F' },
                'case-complaints': { name: 'Chief Complaints', content: 'Abdominal pain - 5 days' },
                'case-examination': { name: 'Examination', content: 'Abdominal tenderness, mild distension' },
                'case-investigation': { name: 'Investigation', content: 'Blood tests, Ultrasound abdomen' },
                'case-diagnosis': { name: 'Diagnosis', content: 'Acute gastritis with mild inflammation' },
                'case-prescription': { name: 'Prescription', content: 'Tab Gelusi MPS, Paracetamol' },
                'case-therapy': { name: 'Therapy', content: 'Diet modification, rest, follow-up in 3 days' },
                'case-instructions': { name: 'Instructions', content: 'Take medication with food, avoid spicy foods' },
                'case-tooth-chart': { name: 'Tooth Chart', content: 'Dental examination completed' },
                'case-daycare': { name: 'DayCare Summary', content: 'Patient stable, vitals normal' },
                'case-visit-summary': { name: 'Visit Summary', content: 'Follow-up scheduled for next week' },
                'case-vaccine': { name: 'Vaccine', content: 'No vaccines required at this time' },
                'case-brand-list': { name: 'Brand List', content: 'Generic medications prescribed' },
                'case-treatment-plan': { name: 'Treatment Plan', content: 'Conservative management with medication' },
                'case-nurse-notes': { name: 'Nurse Notes', content: 'Patient cooperative, no complications' }
            };
            
            // Create sections based on configuration
            let hasVisibleSections = false;
            Object.entries(sectionData).forEach(([configKey, data]) => {
                if (config[configKey]) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'bg-gray-50 p-3 rounded-lg';
                    sectionDiv.innerHTML = `
                        <div class="flex items-center space-x-2 overflow-x-auto">
                            <span class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">${data.name}:</span>
                            <div id="content-${configKey}" class="flex items-center space-x-2 flex-1 min-w-0"></div>
                            <i class="fas fa-plus text-gray-400 cursor-pointer hover:text-orange-500 flex-shrink-0" onclick="addContentToSection('${configKey}', this)"></i>
                        </div>
                    `;
                    caseSheetContent.appendChild(sectionDiv);
                    hasVisibleSections = true;
                }
            });
            
            // Show case sheet content if there are visible sections
            if (hasVisibleSections) {
                caseSheetContent.style.display = 'block';
            } else {
                caseSheetContent.style.display = 'none';
            }
        }

        function addContentToSection(sectionKey, plusIcon) {
            const contentContainer = document.getElementById(`content-${sectionKey}`);
            if (!contentContainer) return;
            
            // Create input field container
            const inputContainer = document.createElement('div');
            // inputContainer.className = 'flex items-center space-x-1 bg-white px-2 py-1 rounded border border-gray-300';
            inputContainer.className = 'flex items-center space-x-1 px-2 py-1 bg-gray-200 rounded-full';
inputContainer.style.border = 'none';

            
            // Create input field with auto width
            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.placeholder = 'Enter...';
            inputField.className = 'px-2 py-1 border-none outline-none text-sm bg-transparent min-w-20 max-w-40';
            inputField.style.width = '80px'; // Initial width
            
            // Auto-resize input based on content
            inputField.addEventListener('input', function() {
                this.style.width = Math.max(80, this.value.length * 8 + 20) + 'px';
            });
            
            // Create save button
            const saveBtn = document.createElement('button');
            saveBtn.innerHTML = '<i class="fas fa-check text-green-500 text-xs"></i>';
            saveBtn.className = ' rounded p-1';
            saveBtn.onclick = () => saveContentToSection(sectionKey, inputField.value, inputContainer);
            
            // Create cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = '<i class="fas fa-times text-red-500 text-xs"></i>';
            cancelBtn.className = ' rounded p-1';
            cancelBtn.onclick = () => inputContainer.remove();
            
            // Add elements to container
            inputContainer.appendChild(inputField);
            inputContainer.appendChild(saveBtn);
            inputContainer.appendChild(cancelBtn);
            
            // Add to content container
            contentContainer.appendChild(inputContainer);
            
            // Focus on input field
            inputField.focus();
        }
        
        function saveContentToSection(sectionKey, content, inputContainer) {
            if (!content.trim()) {
                inputContainer.remove();
                return;
            }
            
            // Create content display element (inline)
            const contentDisplay = document.createElement('div');
            contentDisplay.className = 'flex items-center space-x-1 bg-blue-50 px-2 py-1 rounded border border-blue-200';
            contentDisplay.innerHTML = `
                <span class="text-sm text-gray-700 whitespace-nowrap">${content}</span>
                <button onclick="editContent(this)" class="text-blue-500 hover:text-blue-700">
                    <i class="fas fa-edit text-xs"></i>
                </button>
                <button onclick="deleteContent(this)" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-trash text-xs"></i>
                </button>
            `;
            
            // Replace input container with content display
            inputContainer.parentNode.replaceChild(contentDisplay, inputContainer);
        }
        
        function editContent(editBtn) {
            const contentDisplay = editBtn.closest('.flex');
            const contentSpan = contentDisplay.querySelector('span');
            const currentContent = contentSpan.textContent;
            
            // Create input field
            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.value = currentContent;
            inputField.className = 'flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:border-orange-500';
            
            // Create save button
            const saveBtn = document.createElement('button');
            saveBtn.innerHTML = '<i class="fas fa-check text-green-500"></i>';
            saveBtn.className = 'px-2 py-1 hover:bg-green-50 rounded';
            saveBtn.onclick = () => {
                contentSpan.textContent = inputField.value;
                inputField.parentNode.replaceChild(contentSpan, inputField);
                saveBtn.parentNode.replaceChild(editBtn.parentNode, saveBtn.parentNode);
            };
            
            // Replace content with input
            contentSpan.parentNode.replaceChild(inputField, contentSpan);
            editBtn.parentNode.replaceChild(saveBtn, editBtn.parentNode);
            
            inputField.focus();
        }
        
        function deleteContent(deleteBtn) {
            deleteBtn.closest('.flex').remove();
        }

        function updateSaveButton() {
            const confirmCheckbox = document.getElementById('confirm-changes');
            const saveBtn = document.getElementById('save-config-btn');
            
            if (confirmCheckbox && saveBtn) {
                saveBtn.disabled = !confirmCheckbox.checked;
            }
        }

        // Select All functionality
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all-sections');
            const checkboxes = [
                'case-vitals', 'case-complaints', 'case-examination', 'case-investigation',
                'case-diagnosis', 'case-prescription', 'case-therapy', 'case-instructions',
                'case-tooth-chart', 'case-daycare', 'case-visit-summary', 'case-vaccine',
                'case-brand-list', 'case-treatment-plan', 'case-nurse-notes'
            ];
            
            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = selectAllCheckbox.checked;
                }
            });
        }

        // Add event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize case sheet - hide content initially
            const caseSheetContent = document.getElementById('case-sheet-content');
            if (caseSheetContent) {
                caseSheetContent.style.display = 'none';
            }
            
            // Check if we have a saved configuration
            const hasConfig = localStorage.getItem('caseSheetConfig');
            if (hasConfig) {
                updateCaseSheetDisplay();
            }
            
            // Add event listener for confirmation checkbox
            const confirmCheckbox = document.getElementById('confirm-changes');
            if (confirmCheckbox) {
                confirmCheckbox.addEventListener('change', updateSaveButton);
            }
            
            // Add event listener for Select All checkbox
            const selectAllCheckbox = document.getElementById('select-all-sections');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', toggleSelectAll);
            }
        });

        // Check for new medicines from add-medicine page
        function checkForNewMedicines() {
            const newMedicines = JSON.parse(localStorage.getItem('newMedicines') || '[]');
            if (newMedicines.length > 0) {
                // Add each new medicine to the first prescription table
                const firstTable = document.querySelector('#subpanel-prescription tbody');
                if (firstTable) {
                    newMedicines.forEach(medicine => {
                        const newRow = document.createElement('tr');
                        newRow.className = 'hover:bg-orange-50 transition-colors duration-150';
                        newRow.innerHTML = `
                            <td class="py-3 px-4"><input type="checkbox" class="rounded text-orange-500 focus:ring-orange-500"></td>
                            <td class="py-3 px-4 text-gray-500">-</td>
                        `;
                        firstTable.appendChild(newRow);
                    });
                }
                // Clear the stored medicines
                localStorage.removeItem('newMedicines');
            }
        }

        // Check for new medicines when page loads
        checkForNewMedicines();

        // Initialize currency on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for CurrencyHelper to be available
            setTimeout(function() {
                // Check if bills panel is visible (e.g., from URL hash)
                if (window.location.hash === '#bills') {
                    const billsPanel = document.getElementById('panel-bills');
                    if (billsPanel) {
                        billsPanel.classList.remove('hidden');
                        initCurrencySelector();
                    }
                }
                
                // Also initialize if panel is already visible
                const billsPanel = document.getElementById('panel-bills');
                if (billsPanel && !billsPanel.classList.contains('hidden')) {
                    initCurrencySelector();
                }
            }, 300);
        });

    </script>

    <!-- Configure Case Sheet Modal -->
    <div id="configure-case-sheet-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <h3 class="text-lg font-semibold text-gray-800">Configure Case Sheet</h3>
                <button onclick="closeConfigureCaseSheet()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <p class="text-sm text-gray-600 mb-4">Select which sections you want to display on the case sheet:</p>
                
                <!-- Select All Checkbox -->
                <div class="flex items-center justify-between py-3 border-b-2 border-orange-200 mb-4">
                    <span class="text-sm font-semibold text-gray-800">Select All</span>
                    <input type="checkbox" id="select-all-sections" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500" checked>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Vitals</span>
                        <input type="checkbox" id="case-vitals" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Chief Complaints</span>
                        <input type="checkbox" id="case-complaints" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Examination</span>
                        <input type="checkbox" id="case-examination" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Investigation</span>
                        <input type="checkbox" id="case-investigation" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Diagnosis</span>
                        <input type="checkbox" id="case-diagnosis" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Prescription</span>
                        <input type="checkbox" id="case-prescription" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Therapy</span>
                        <input type="checkbox" id="case-therapy" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Instructions</span>
                        <input type="checkbox" id="case-instructions" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Tooth Chart</span>
                        <input type="checkbox" id="case-tooth-chart" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">DayCare Summary</span>
                        <input type="checkbox" id="case-daycare" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Visit Summary</span>
                        <input type="checkbox" id="case-visit-summary" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Vaccine</span>
                        <input type="checkbox" id="case-vaccine" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Brand List</span>
                        <input type="checkbox" id="case-brand-list" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Treatment Plan</span>
                        <input type="checkbox" id="case-treatment-plan" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                    <div class="flex items-center justify-between py-2 border-b border-gray-100">
                        <span class="text-sm font-medium text-gray-700">Nurse Notes</span>
                        <input type="checkbox" id="case-nurse-notes" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                    <p class="text-sm text-yellow-800 mb-2">
                        <strong>Note:</strong> Only selected sections will be accessible. Changes will affect your OP Case Sheet.
                    </p>
                    <div class="flex items-center">
                        <input type="checkbox" id="confirm-changes" class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                        <label for="confirm-changes" class="ml-2 text-sm text-gray-700">
                            I want to continue with the changes
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center justify-end space-x-3 p-6 border-t bg-gray-50">
                <button onclick="closeConfigureCaseSheet()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded hover:bg-gray-50">
                    Cancel
                </button>
                <button onclick="saveCaseSheetConfig()" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50" id="save-config-btn" disabled>
                    Save Configuration
                </button>
            </div>
        </div>
    </div>

    <!-- New Order Modal -->
    <div id="new-order-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-3 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-4 sm:px-6 py-4 flex items-center justify-between z-10">
                <h3 class="text-lg sm:text-xl font-semibold text-gray-900">New Order</h3>
                <button onclick="closeNewOrderModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="new-order-form" class="p-4 sm:p-6" onsubmit="handleNewOrderSubmit(event)">
                <div class="space-y-4 sm:space-y-6">
                    <!-- Patient Selection -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Patient *</label>
                        <select id="patient-select" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" required>
                            <option value="">Select Patient</option>
                            <option value="MRN-1247" selected>Michael Chen (MRN-1247)</option>
                            <option value="MRN-1245">Sarah Johnson (MRN-1245)</option>
                            <option value="MRN-1250">Emily Davis (MRN-1250)</option>
                            <option value="MRN-1251">Robert Wilson (MRN-1251)</option>
                        </select>
                    </div>
                    
                    <!-- Item/Test -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Item/Test *</label>
                        <input type="text" id="item-test" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" placeholder="e.g., Chest X-Ray, Blood Test" required />
                    </div>
                    
                    <!-- Ordered By -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Ordered By *</label>
                        <select id="ordered-by" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" required>
                            <option value="">Select Doctor</option>
                            <option value="Dr. Usman">Dr. Usman</option>
                            <option value="Dr. John Doe">Dr. John Doe</option>
                            <option value="Dr. Jane Smith">Dr. Jane Smith</option>
                            <option value="Dr. Mark Wilson">Dr. Mark Wilson</option>
                            <option value="Dr. Sarah Lee">Dr. Sarah Lee</option>
                        </select>
                    </div>
                    
                    <!-- Status -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Status *</label>
                        <select id="order-status" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" required>
                            <option value="pending" selected>Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    
                    <!-- Date and Time -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Order Date *</label>
                            <input type="date" id="order-date" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" required />
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Order Time *</label>
                            <input type="time" id="order-time" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" required />
                        </div>
                    </div>
                    
                    <!-- Priority (optional) -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Priority</label>
                        <select id="order-priority" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm">
                            <option value="routine" selected>Routine</option>
                            <option value="urgent">Urgent</option>
                            <option value="stat">Stat</option>
                        </select>
                    </div>
                    
                    <!-- Notes (optional) -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Notes</label>
                        <textarea id="order-notes" rows="3" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-xs sm:text-sm" placeholder="Additional notes or instructions..."></textarea>
                    </div>
                </div>
                
                <!-- Modal Actions -->
                <div class="mt-6 sm:mt-8 flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end pt-4 sm:pt-6 border-t border-gray-200">
                    <button type="button" onclick="closeNewOrderModal()" class="px-4 sm:px-6 py-2 sm:py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-xs sm:text-sm font-medium w-full sm:w-auto">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 sm:px-6 py-2 sm:py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-xs sm:text-sm font-medium w-full sm:w-auto">
                        <i class="fas fa-save mr-2"></i>Save Order
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const sidebar = document.getElementById('sidebar-patient');
        const overlay = document.getElementById('sidebar-overlay');

        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.add('active');
                overlay.classList.add('active');
            });
        }

        if (closeSidebarBtn) {
            closeSidebarBtn.addEventListener('click', () => {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
        }

        if (overlay) {
            overlay.addEventListener('click', () => {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
        }

        // New Order Modal Functions
        function openNewOrderModal() {
            const modal = document.getElementById('new-order-modal');
            const form = document.getElementById('new-order-form');
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('order-date').value = today;
            
            // Set current time as default
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('order-time').value = `${hours}:${minutes}`;
            
            // Reset form
            form.reset();
            
            // Set defaults again after reset
            document.getElementById('order-date').value = today;
            document.getElementById('order-time').value = `${hours}:${minutes}`;
            document.getElementById('order-status').value = 'pending';
            document.getElementById('order-priority').value = 'routine';
            document.getElementById('patient-select').value = 'MRN-1247';
            
            // Show modal
            modal.classList.remove('hidden');
        }

        function closeNewOrderModal() {
            const modal = document.getElementById('new-order-modal');
            const form = document.getElementById('new-order-form');
            modal.classList.add('hidden');
            form.reset();
        }

        function handleNewOrderSubmit(event) {
            event.preventDefault();
            
            // Get form values
            const formData = {
                patient: document.getElementById('patient-select').value,
                itemTest: document.getElementById('item-test').value,
                orderedBy: document.getElementById('ordered-by').value,
                status: document.getElementById('order-status').value,
                orderDate: document.getElementById('order-date').value,
                orderTime: document.getElementById('order-time').value,
                priority: document.getElementById('order-priority').value,
                notes: document.getElementById('order-notes').value
            };
            
            // Here you would typically send the data to a server
            console.log('New Order Data:', formData);
            
            // Show success message (you can customize this)
            alert('Order saved successfully!');
            
            // Close modal
            closeNewOrderModal();
            
            // Optionally refresh the orders list or add the order to the table
            // You can implement this based on your needs
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('new-order-modal');
            if (event.target === modal) {
                closeNewOrderModal();
            }
        });
    </script>

</body>
</html>




