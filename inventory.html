<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Inventory - Hospital Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="shared-sidebar.js"></script>
    <style>
        :root {
            --accent-50: #fff7ed;
            --accent-100: #ffedd5;
            --accent-200: #fed7aa;
            --accent-300: #fdba74;
            --accent-400: #fb923c;
            --accent-500: #f97316;
            --accent-600: #ea580c;
            --accent-700: #c2410c;
            --accent-800: #9a3412;
            --accent-900: #7c2d12;
            --accent-950: #431407;
        }
        .bg-orange-50{background-color:var(--accent-50)!important}
        .bg-orange-100{background-color:var(--accent-100)!important}
        .bg-orange-200{background-color:var(--accent-200)!important}
        .bg-orange-300{background-color:var(--accent-300)!important}
        .bg-orange-400{background-color:var(--accent-400)!important}
        .bg-orange-500{background-color:var(--accent-500)!important}
        .bg-orange-600{background-color:var(--accent-600)!important}
        .text-orange-600{color:var(--accent-600)!important}
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Shared Sidebar -->
        <div id="shared-sidebar"></div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-gray-100 px-6 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Search anything..." 
                               class="w-80 px-4 py-2 pl-10 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-bell text-lg"></i>
                    </button>
                    <button class="text-gray-600 hover:text-gray-800" id="open-settings">
                        <i class="fas fa-cog text-lg"></i>
                    </button>
                    <button class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-question-circle text-lg"></i>
                    </button>
                    
                    <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-lg">
                        <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-medium">M</span>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-800">M. Usman</div>
                            <div class="text-xs text-gray-500">Admin</div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400"></i>
                    </div>
                </div>
            </header>
            
            <!-- Inventory Content -->
            <main class="flex-1 p-6 overflow-y-auto">
                <!-- Header Section -->
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-2xl font-semibold text-gray-900">Hospital Inventory</h1>
                </div>

                <!-- Pending Doctor Requests Section -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-clipboard-list text-orange-500 mr-2"></i>
                            Pending Doctor Requests
                        </h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="border-b border-gray-200 text-gray-600">
                                <tr>
                                    <th class="text-left px-5 py-3">Doctor Name</th>
                                    <th class="text-left px-5 py-3">Item Name</th>
                                    <th class="text-left px-5 py-3">Category</th>
                                    <th class="text-left px-5 py-3">Quantity Requested</th>
                                    <th class="text-left px-5 py-3">Date Requested</th>
                                    <th class="text-left px-5 py-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pending-requests-tbody" class="divide-y divide-gray-100">
                                <!-- Requests will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Main Stock / Hospital Inventory Section -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-boxes text-orange-500 mr-2"></i>
                            Main Stock
                        </h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="border-b border-gray-200 text-gray-600">
                                <tr>
                                    <th class="text-left px-5 py-3">#</th>
                                    <th class="text-left px-5 py-3">Category</th>
                                    <th class="text-left px-5 py-3">Items Included</th>
                                    <th class="text-left px-5 py-3">Quantity</th>
                                    <th class="text-left px-5 py-3">Status</th>
                                    <th class="text-left px-5 py-3">Remarks</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-gray-800">1</td>
                                    <td class="px-5 py-3 font-medium text-gray-800">Pharmaceuticals & Medications</td>
                                    <td class="px-5 py-3 text-gray-700">Prescription drugs, IV solutions, tablets</td>
                                    <td class="px-5 py-3 text-gray-700">320</td>
                                    <td class="px-5 py-3">
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">In Stock</span>
                                    </td>
                                    <td class="px-5 py-3 text-gray-600 text-sm">Regular update required</td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-gray-800">2</td>
                                    <td class="px-5 py-3 font-medium text-gray-800">Surgical Supplies</td>
                                    <td class="px-5 py-3 text-gray-700">Scalpels, gloves, sutures, sponges</td>
                                    <td class="px-5 py-3 text-gray-700">180</td>
                                    <td class="px-5 py-3">
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium">Low Stock</span>
                                    </td>
                                    <td class="px-5 py-3 text-gray-600 text-sm">Need to reorder gloves</td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-gray-800">3</td>
                                    <td class="px-5 py-3 font-medium text-gray-800">Medical Equipment</td>
                                    <td class="px-5 py-3 text-gray-700">Infusion pumps, X-ray machine, monitors</td>
                                    <td class="px-5 py-3 text-gray-700">12</td>
                                    <td class="px-5 py-3">
                                        <span class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">Under Maintenance</span>
                                    </td>
                                    <td class="px-5 py-3 text-gray-600 text-sm">1 monitor under service</td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-gray-800">4</td>
                                    <td class="px-5 py-3 font-medium text-gray-800">PPE</td>
                                    <td class="px-5 py-3 text-gray-700">Masks, gowns, gloves</td>
                                    <td class="px-5 py-3 text-gray-700">500</td>
                                    <td class="px-5 py-3">
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">In Stock</span>
                                    </td>
                                    <td class="px-5 py-3 text-gray-600 text-sm">Ready for use</td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-gray-800">5</td>
                                    <td class="px-5 py-3 font-medium text-gray-800">Patient Care Items</td>
                                    <td class="px-5 py-3 text-gray-700">Bandages, syringes, catheters</td>
                                    <td class="px-5 py-3 text-gray-700">250</td>
                                    <td class="px-5 py-3">
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">In Stock</span>
                                    </td>
                                    <td class="px-5 py-3 text-gray-600 text-sm">Adequate supply</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Theme loader
        function loadTheme(){ 
            const saved = localStorage.getItem('hm_accent_hex'); 
            if(saved){ 
                const root=document.documentElement; 
                root.style.setProperty('--accent-500', saved);
            } 
        }
        loadTheme();

        // Initialize shared sidebar
        document.addEventListener('DOMContentLoaded', function() {
            // Load shared sidebar with 'inventory' as active page
            document.getElementById('shared-sidebar').innerHTML = createSharedSidebar('inventory');
            initSharedSidebar('inventory');
            
            // Load pending requests
            loadPendingRequests();
        });

        // Load pending doctor requests from localStorage
        function loadPendingRequests() {
            const tbody = document.getElementById('pending-requests-tbody');
            tbody.innerHTML = ''; // Clear existing rows
            
            // Get all inventory requests from localStorage
            const allRequests = JSON.parse(localStorage.getItem('hm_inventory_requests') || '[]');
            
            // Filter only pending requests
            const pendingRequests = allRequests.filter(req => req.status === 'Pending');
            
            if (pendingRequests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-5 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-3xl mb-2"></i>
                            <p>No pending requests</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Display pending requests
            pendingRequests.forEach((request, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.dataset.requestId = request.id;
                
                const requestDate = new Date(request.dateRequested).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                row.innerHTML = `
                    <td class="px-5 py-3 text-gray-800">${request.doctorName || 'Dr. Unknown'}</td>
                    <td class="px-5 py-3 text-gray-700">${request.itemName}</td>
                    <td class="px-5 py-3 text-gray-700">${request.category}</td>
                    <td class="px-5 py-3 text-gray-700">${request.quantity}</td>
                    <td class="px-5 py-3 text-gray-700">${requestDate}</td>
                    <td class="px-5 py-3">
                        <div class="flex items-center space-x-2">
                            <button onclick="approveRequest('${request.id}')" class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-xs font-medium">
                                <i class="fas fa-check mr-1"></i>Approve
                            </button>
                            <button onclick="rejectRequest('${request.id}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-xs font-medium">
                                <i class="fas fa-times mr-1"></i>Reject
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Approve request
        function approveRequest(requestId) {
            if (!confirm('Are you sure you want to approve this request?')) {
                return;
            }
            
            const allRequests = JSON.parse(localStorage.getItem('hm_inventory_requests') || '[]');
            const requestIndex = allRequests.findIndex(req => req.id === requestId);
            
            if (requestIndex !== -1) {
                allRequests[requestIndex].status = 'Approved';
                allRequests[requestIndex].dateProcessed = new Date().toISOString();
                localStorage.setItem('hm_inventory_requests', JSON.stringify(allRequests));
                
                // Trigger storage event for other tabs
                window.dispatchEvent(new Event('storage'));
                // Trigger custom event for same tab
                window.dispatchEvent(new Event('inventoryRequestUpdated'));
                
                // Reload the table
                loadPendingRequests();
                alert('Request approved successfully!');
            }
        }

        // Reject request
        function rejectRequest(requestId) {
            if (!confirm('Are you sure you want to reject this request?')) {
                return;
            }
            
            const allRequests = JSON.parse(localStorage.getItem('hm_inventory_requests') || '[]');
            const requestIndex = allRequests.findIndex(req => req.id === requestId);
            
            if (requestIndex !== -1) {
                allRequests[requestIndex].status = 'Rejected';
                allRequests[requestIndex].dateProcessed = new Date().toISOString();
                localStorage.setItem('hm_inventory_requests', JSON.stringify(allRequests));
                
                // Trigger storage event for other tabs
                window.dispatchEvent(new Event('storage'));
                // Trigger custom event for same tab
                window.dispatchEvent(new Event('inventoryRequestUpdated'));
                
                // Reload the table
                loadPendingRequests();
                alert('Request rejected.');
            }
        }

        // Listen for new requests (triggered from doctor-detail page)
        window.addEventListener('storage', function(e) {
            if (e.key === 'hm_inventory_requests') {
                loadPendingRequests();
            }
        });

        // Also listen for custom events (for same-tab updates)
        window.addEventListener('inventoryRequestUpdated', function() {
            loadPendingRequests();
        });
    </script>
</body>
</html>
